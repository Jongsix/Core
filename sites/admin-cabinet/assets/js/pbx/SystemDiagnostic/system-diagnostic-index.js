"use strict";

/*
 * Copyright Â© MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Alexey Portnov, 8 2020
 */

/* global sessionStorage, ace, PbxApi */
var systemDiagnostic = {
  $startBtn: $('#start-capture-button'),
  $stopBtn: $('#stop-capture-button'),
  $showBtn: $('#show-last-log'),
  viewer: '',
  $tabMenuItems: $('#system-diagnostic-menu .item'),
  $fileSelectDropDown: $('#system-diagnostic-form .type-select'),
  initialize: function () {
    function initialize() {
      systemDiagnostic.$tabMenuItems.tab();
      systemDiagnostic.$tabMenuItems.tab('change tab', 'show-log');
      systemDiagnostic.$fileSelectDropDown.dropdown();
      systemDiagnostic.$showBtn.on('click', function (e) {
        e.preventDefault();
        var Lines = $('#lines').val();

        if (!jQuery.isNumeric(Lines)) {
          Lines = 500;
        }

        PbxApi.GetLogFromFile($('#filenames').val(), $('#filter').val(), Lines, systemDiagnostic.cbUpdateLogText);
      });

      if (sessionStorage.getItem('LogsCaptureStatus') === 'started') {
        systemDiagnostic.$startBtn.addClass('disabled loading');
        systemDiagnostic.$stopBtn.removeClass('disabled');
      } else {
        systemDiagnostic.$startBtn.removeClass('disabled loading');
        systemDiagnostic.$stopBtn.addClass('disabled');
      }

      systemDiagnostic.$startBtn.on('click', function (e) {
        e.preventDefault();
        systemDiagnostic.$startBtn.addClass('disabled loading');
        systemDiagnostic.$stopBtn.removeClass('disabled');
        PbxApi.SystemStartLogsCapture();
      });
      systemDiagnostic.$stopBtn.on('click', function (e) {
        e.preventDefault();
        systemDiagnostic.$startBtn.removeClass('disabled loading');
        systemDiagnostic.$stopBtn.addClass('disabled');
        PbxApi.SystemStopLogsCapture(systemDiagnostic.cbAfterStopLogsCapture);
      });
      systemDiagnostic.initializeAce();
    }

    return initialize;
  }(),
  initializeAce: function () {
    function initializeAce() {
      var IniMode = ace.require('ace/mode/julia').Mode;

      systemDiagnostic.viewer = ace.edit('application-code-readonly');
      systemDiagnostic.viewer.setReadOnly(true);
      systemDiagnostic.viewer.session.setMode(new IniMode());
      systemDiagnostic.viewer.setTheme('ace/theme/monokai');
      systemDiagnostic.viewer.resize();
      var $codeElement = $('#application-code-readonly');
      var Length = $codeElement.height() * 0.80;
      $codeElement.height(Length);
      $('.ace_gutter').hide();
      setTimeout(systemDiagnostic.cbUpdateLogText, 2000);
    }

    return initializeAce;
  }(),
  cbAfterStopLogsCapture: function () {
    function cbAfterStopLogsCapture(response) {// console.log(response);
    }

    return cbAfterStopLogsCapture;
  }(),
  cbUpdateLogText: function () {
    function cbUpdateLogText(data) {
      if (typeof data !== 'undefined' && data.length > 0) {
        systemDiagnostic.viewer.setValue(data[0]);
      }

      systemDiagnostic.viewer.gotoLine($('#lines').val());
    }

    return cbUpdateLogText;
  }()
};
$(document).ready(function () {
  systemDiagnostic.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TeXN0ZW1EaWFnbm9zdGljL3N5c3RlbS1kaWFnbm9zdGljLWluZGV4LmpzIl0sIm5hbWVzIjpbInN5c3RlbURpYWdub3N0aWMiLCIkc3RhcnRCdG4iLCIkIiwiJHN0b3BCdG4iLCIkc2hvd0J0biIsInZpZXdlciIsIiR0YWJNZW51SXRlbXMiLCIkZmlsZVNlbGVjdERyb3BEb3duIiwiaW5pdGlhbGl6ZSIsInRhYiIsImRyb3Bkb3duIiwib24iLCJlIiwicHJldmVudERlZmF1bHQiLCJMaW5lcyIsInZhbCIsImpRdWVyeSIsImlzTnVtZXJpYyIsIlBieEFwaSIsIkdldExvZ0Zyb21GaWxlIiwiY2JVcGRhdGVMb2dUZXh0Iiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRJdGVtIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsIlN5c3RlbVN0YXJ0TG9nc0NhcHR1cmUiLCJTeXN0ZW1TdG9wTG9nc0NhcHR1cmUiLCJjYkFmdGVyU3RvcExvZ3NDYXB0dXJlIiwiaW5pdGlhbGl6ZUFjZSIsIkluaU1vZGUiLCJhY2UiLCJyZXF1aXJlIiwiTW9kZSIsImVkaXQiLCJzZXRSZWFkT25seSIsInNlc3Npb24iLCJzZXRNb2RlIiwic2V0VGhlbWUiLCJyZXNpemUiLCIkY29kZUVsZW1lbnQiLCJMZW5ndGgiLCJoZWlnaHQiLCJoaWRlIiwic2V0VGltZW91dCIsInJlc3BvbnNlIiwiZGF0YSIsImxlbmd0aCIsInNldFZhbHVlIiwiZ290b0xpbmUiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBTUE7QUFFQSxJQUFNQSxnQkFBZ0IsR0FBRztBQUN4QkMsRUFBQUEsU0FBUyxFQUFFQyxDQUFDLENBQUMsdUJBQUQsQ0FEWTtBQUV4QkMsRUFBQUEsUUFBUSxFQUFHRCxDQUFDLENBQUMsc0JBQUQsQ0FGWTtBQUd4QkUsRUFBQUEsUUFBUSxFQUFHRixDQUFDLENBQUMsZ0JBQUQsQ0FIWTtBQUl4QkcsRUFBQUEsTUFBTSxFQUFFLEVB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O0FBdUVBYixDQUFDLENBQUMrQyxRQUFELENBQUQsQ0FBWUMsS0FBWixDQUFrQixZQUFNO0FBQ3ZCbEQsRUFBQUEsZ0JBQWdCLENBQUNRLFVBQWpCO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgwqkgTUlLTyBMTEMgLSBBbGwgUmlnaHRzIFJlc2VydmVkXG4gKiBVbmF1dGhvcml6ZWQgY29weWluZyBvZiB0aGlzIGZpbGUsIHZpYSBhbnkgbWVkaXVtIGlzIHN0cmljdGx5IHByb2hpYml0ZWRcbiAqIFByb3ByaWV0YXJ5IGFuZCBjb25maWRlbnRpYWxcbiAqIFdyaXR0ZW4gYnkgQWxleGV5IFBvcnRub3YsIDggMjAyMFxuICovXG4vKiBnbG9iYWwgc2Vzc2lvblN0b3JhZ2UsIGFjZSwgUGJ4QXBpICovXG5cbmNvbnN0IHN5c3RlbURpYWdub3N0aWMgPSB7XG5cdCRzdGFydEJ0bjogJCgnI3N0YXJ0LWNhcHR1cmUtYnV0dG9uJyksXG5cdCRzdG9wQnRuOiAgJCgnI3N0b3AtY2FwdHVyZS1idXR0b24nKSxcblx0JHNob3dCdG46ICAkKCcjc2hvdy1sYXN0LWxvZycpLFxuXHR2aWV3ZXI6ICcnLFxuXHQkdGFiTWVudUl0ZW1zOiAkKCcjc3lzdGVtLWRpYWdub3N0aWMtbWVudSAuaXRlbScpLFxuXHQkZmlsZVNlbGVjdERyb3BEb3duOiAkKCcjc3lzdGVtLWRpYWdub3N0aWMtZm9ybSAudHlwZS1zZWxlY3QnKSxcblxuXHRpbml0aWFsaXplKCkge1xuXHRcdHN5c3RlbURpYWdub3N0aWMuJHRhYk1lbnVJdGVtcy50YWIoKTtcblx0XHRzeXN0ZW1EaWFnbm9zdGljLiR0YWJNZW51SXRlbXMudGFiKCdjaGFuZ2UgdGFiJywgJ3Nob3ctbG9nJyk7XG5cblx0XHRzeXN0ZW1EaWFnbm9zdGljLiRmaWxlU2VsZWN0RHJvcERvd24uZHJvcGRvd24oKTtcblxuXHRcdHN5c3RlbURpYWdub3N0aWMuJHNob3dCdG4ub24oJ2NsaWNrJywgKGUpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGxldCBMaW5lcyA9ICQoJyNsaW5lcycpLnZhbCgpO1xuXHRcdFx0aWYoIWpRdWVyeS5pc051bWVyaWMoIExpbmVzKSl7XG5cdFx0XHRcdExpbmVzID0gNTAwO1xuXHRcdFx0fVxuXHRcdFx0UGJ4QXBpLkdldExvZ0Zyb21GaWxlKCQoJyNmaWxlbmFtZXMnKS52YWwoKSwgJCgnI2ZpbHRlcicpLnZhbCgpLCBMaW5lcyAsIHN5c3RlbURpYWdub3N0aWMuY2JVcGRhdGVMb2dUZXh0KVxuXHRcdH0pO1xuXG5cdFx0aWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ0xvZ3NDYXB0dXJlU3RhdHVzJykgPT09ICdzdGFydGVkJykge1xuXHRcdFx0c3lzdGVtRGlhZ25vc3RpYy4kc3RhcnRCdG4uYWRkQ2xhc3MoJ2Rpc2FibGVkIGxvYWRpbmcnKTtcblx0XHRcdHN5c3RlbURpYWdub3N0aWMuJHN0b3BCdG4ucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHN5c3RlbURpYWdub3N0aWMuJHN0YXJ0QnRuLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCBsb2FkaW5nJyk7XG5cdFx0XHRzeXN0ZW1EaWFnbm9zdGljLiRzdG9wQnRuLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdH1cblx0XHRzeXN0ZW1EaWFnbm9zdGljLiRzdGFydEJ0bi5vbignY2xpY2snLCAoZSkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0c3lzdGVtRGlhZ25vc3RpYy4kc3RhcnRCdG4uYWRkQ2xhc3MoJ2Rpc2FibGVkIGxvYWRpbmcnKTtcblx0XHRcdHN5c3RlbURpYWdub3N0aWMuJHN0b3BCdG4ucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRQYnhBcGkuU3lzdGVtU3RhcnRMb2dzQ2FwdHVyZSgpO1xuXHRcdH0pO1xuXHRcdHN5c3RlbURpYWdub3N0aWMuJHN0b3BCdG4ub24oJ2NsaWNrJywgKGUpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHN5c3RlbURpYWdub3N0aWMuJHN0YXJ0QnRuLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCBsb2FkaW5nJyk7XG5cdFx0XHRzeXN0ZW1EaWFnbm9zdGljLiRzdG9wQnRuLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0UGJ4QXBpLlN5c3RlbVN0b3BMb2dzQ2FwdHVyZShzeXN0ZW1EaWFnbm9zdGljLmNiQWZ0ZXJTdG9wTG9nc0NhcHR1cmUpO1xuXHRcdH0pO1xuXG5cdFx0c3lzdGVtRGlhZ25vc3RpYy5pbml0aWFsaXplQWNlKCk7XG5cdH0sXG5cdGluaXRpYWxpemVBY2UoKSB7XG5cdFx0Y29uc3QgSW5pTW9kZSA9IGFjZS5yZXF1aXJlKCdhY2UvbW9kZS9qdWxpYScpLk1vZGU7XG5cdFx0c3lzdGVtRGlhZ25vc3RpYy52aWV3ZXIgPSBhY2UuZWRpdCgnYXBwbGljYXRpb24tY29kZS1yZWFkb25seScpO1xuXHRcdHN5c3RlbURpYWdub3N0aWMudmlld2VyLnNldFJlYWRPbmx5KHRydWUpO1xuXHRcdHN5c3RlbURpYWdub3N0aWMudmlld2VyLnNlc3Npb24uc2V0TW9kZShuZXcgSW5pTW9kZSgpKTtcblx0XHRzeXN0ZW1EaWFnbm9zdGljLnZpZXdlci5zZXRUaGVtZSgnYWNlL3RoZW1lL21vbm9rYWknKTtcblx0XHRzeXN0ZW1EaWFnbm9zdGljLnZpZXdlci5yZXNpemUoKTtcblxuXHRcdGNvbnN0ICRjb2RlRWxlbWVudCA9ICQoJyNhcHBsaWNhdGlvbi1jb2RlLXJlYWRvbmx5Jyk7XG5cdFx0Y29uc3QgTGVuZ3RoID0gJGNvZGVFbGVtZW50LmhlaWdodCgpICogMC44MDtcblx0XHQkY29kZUVsZW1lbnQuaGVpZ2h0KExlbmd0aCk7XG5cdFx0JCgnLmFjZV9ndXR0ZXInKS5oaWRlKCk7XG5cblx0XHRzZXRUaW1lb3V0KHN5c3RlbURpYWdub3N0aWMuY2JVcGRhdGVMb2dUZXh0LCAyMDAwKTtcblx0fSxcblx0Y2JBZnRlclN0b3BMb2dzQ2FwdHVyZShyZXNwb25zZSkge1xuXHRcdC8vIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblx0fSxcblx0Y2JVcGRhdGVMb2dUZXh0KGRhdGEpIHtcblx0XHRpZiAodHlwZW9mIChkYXRhKSAhPT0gJ3VuZGVmaW5lZCcgJiYgZGF0YS5sZW5ndGggPiAwKSB7XG5cdFx0XHRzeXN0ZW1EaWFnbm9zdGljLnZpZXdlci5zZXRWYWx1ZShkYXRhWzBdKTtcblx0XHR9XG5cdFx0c3lzdGVtRGlhZ25vc3RpYy52aWV3ZXIuZ290b0xpbmUoJCgnI2xpbmVzJykudmFsKCkpXG5cdH0sXG59O1xuXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG5cdHN5c3RlbURpYWdub3N0aWMuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==