"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl, globalTranslate, Extensions,Form  */
// Проверка нет ли ошибки занятого другой учеткой номера
$.fn.form.settings.rules.existRule = function (value, parameter) {
  return $("#".concat(parameter)).hasClass('hidden');
};

var callQueue = {
  defaultExtension: '',
  $number: $('#extension'),
  $dirrtyField: $('#dirrty'),
  AvailableMembersList: [],
  $formObj: $('#queue-form'),
  $accordions: $('#queue-form .ui.accordion'),
  $dropDowns: $('#queue-form .dropdown'),
  $errorMessages: $('#form-error-messages'),
  $checkBoxes: $('#queue-form .checkbox'),
  forwardingSelect: '#queue-form .forwarding-select',
  $deleteRowButton: $('.delete-row-button'),
  $periodicAnnounceDropdown: $('#queue-form .periodic-announce-sound-id-select'),
  memberRow: '#queue-form .member-row',
  $extensionSelectDropdown: $('#extensionselect'),
  $extensionsTable: $('#extensionsTable'),
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cq_ValidateNameEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'number',
        prompt: globalTranslate.cq_ValidateExtensionNumber
      }, {
        type: 'empty',
        prompt: globalTranslate.cq_ValidateExtensionEmpty
      }, {
        type: 'existRule[extension-error]',
        prompt: globalTranslate.cq_ValidateExtensionDouble
      }]
    }
  },
  initialize: function () {
    function initialize() {
      Extensions.getPhoneExtensions(callQueue.setAvailableQueueMembers);
      callQueue.defaultExtension = $('#extension').val();
      callQueue.$accordions.accordion();
      callQueue.$dropDowns.dropdown();
      callQueue.$checkBoxes.checkbox();
      callQueue.$periodicAnnounceDropdown.dropdown({
        onChange: function () {
          function onChange(value) {
            if (parseInt(value, 10) === -1) {
              callQueue.$periodicAnnounceDropdown.dropdown('clear');
            }
          }

          return onChange;
        }()
      });
      $(callQueue.forwardingSelect).dropdown(Extensions.getDropdownSettingsWithEmpty());
      Extensions.fixBugDropdownIcon(); // Динамическая прововерка свободен ли внутренний номер

      callQueue.$number.on('change', function () {
        var newNumber = callQueue.$formObj.form('get value', 'extension');
        Extensions.checkAvailability(callQueue.defaultNumber, newNumber);
      });
      callQueue.initializeDragAndDropExtensionTableRows(); // Удаление строки из таблицы участников очереди

      callQueue.$deleteRowButton.on('click', function (e) {
        $(e.target).closest('tr').remove();
        callQueue.reinitializeExtensionSelect();
        callQueue.updateExtensionTableView();
        callQueue.$dirrtyField.val(Math.random());
        callQueue.$dirrtyField.trigger('change');
        e.preventDefault();
        return false;
      });
      callQueue.initializeForm();
    }

    return initialize;
  }(),
  setAvailableQueueMembers: function () {
    function setAvailableQueueMembers(arrResult) {
      $.each(arrResult.results, function (index, extension) {
        callQueue.AvailableMembersList.push({
          number: extension.value,
          callerid: extension.name
        });
      });
      callQueue.reinitializeExtensionSelect();
      callQueue.updateExtensionTableView();
    }

    return setAvailableQueueMembers;
  }(),
  // Вернуть список доступных членов очереди
  getAvailableQueueMembers: function () {
    function getAvailableQueueMembers() {
      var result = [];
      callQueue.AvailableMembersList.forEach(function (member) {
        if ($(".member-row#".concat(member.number)).length === 0) {
          result.push({
            name: member.callerid,
            value: member.number
          });
        }
      }); // result.sort((a, b) => ((a.name > b.name) ? 1 : ((b.name > a.name) ? -1 : 0)));

      return result;
    }

    return getAvailableQueueMembers;
  }(),
  // Пересобрать членов очереди с учетом уже выбранных
  reinitializeExtensionSelect: function () {
    function reinitializeExtensionSelect() {
      callQueue.$extensionSelectDropdown.dropdown({
        action: 'hide',
        forceSelection: false,
        onChange: function () {
          function onChange(value, text) {
            if (value) {
              var $tr = $('.member-row-tpl').last();
              var $clone = $tr.clone(true);
              $clone.removeClass('member-row-tpl').addClass('member-row').show();
              $clone.attr('id', value);
              $clone.find('.number').html(value);
              $clone.find('.callerid').html(text);

              if ($(callQueue.memberRow).last().length === 0) {
                $tr.after($clone);
              } else {
                $(callQueue.memberRow).last().after($clone);
              }

              callQueue.reinitializeExtensionSelect();
              callQueue.updateExtensionTableView();
              callQueue.$dirrtyField.val(Math.random());
              callQueue.$dirrtyField.trigger('change');
            }
          }

          return onChange;
        }(),
        values: callQueue.getAvailableQueueMembers()
      });
    }

    return reinitializeExtensionSelect;
  }(),
  // Включить возможность перетаскивания элементов таблицы участников очереди
  initializeDragAndDropExtensionTableRows: function () {
    function initializeDragAndDropExtensionTableRows() {
      callQueue.$extensionsTable.tableDnD({
        onDragClass: 'hoveringRow',
        dragHandle: '.dragHandle',
        onDrop: function () {
          function onDrop() {
            callQueue.$dirrtyField.val(Math.random());
            callQueue.$dirrtyField.trigger('change');
          }

          return onDrop;
        }()
      });
    }

    return initializeDragAndDropExtensionTableRows;
  }(),
  // Отобразить заглушку если в таблице 0 строк
  updateExtensionTableView: function () {
    function updateExtensionTableView() {
      var dummy = "<tr class=\"dummy\"><td colspan=\"4\" class=\"center aligned\">".concat(globalTranslate.cq_AddQueueMembers, "</td></tr>");

      if ($(callQueue.memberRow).length === 0) {
        $('#extensionsTable tbody').append(dummy);
      } else {
        $('#extensionsTable tbody .dummy').remove();
      }
    }

    return updateExtensionTableView;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = callQueue.$formObj.form('get values');
      var arrMembers = [];
      $('#queue-form .member-row').each(function (index, obj) {
        if ($(obj).attr('id')) {
          arrMembers.push({
            number: $(obj).attr('id'),
            priority: index
          });
        }
      });

      if (arrMembers.length === 0) {
        result = false;
        callQueue.$errorMessages.html(globalTranslate.cq_ValidateNoExtensions);
        callQueue.$formObj.addClass('error');
      } else {
        result.data.members = JSON.stringify(arrMembers);
      }

      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {
      callQueue.defaultNumber = callQueue.$number.val();
    }

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = callQueue.$formObj;
      Form.url = "".concat(globalRootUrl, "call-queues/save");
      Form.validateRules = callQueue.validateRules;
      Form.cbBeforeSendForm = callQueue.cbBeforeSendForm;
      Form.cbAfterSendForm = callQueue.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  callQueue.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DYWxsUXVldWVzL2NhbGxxdWV1ZS1tb2RpZnkuanMiXSwibmFtZXMiOlsiJCIsImZuIiwiZm9ybSIsInNldHRpbmdzIiwicnVsZXMiLCJleGlzdFJ1bGUiLCJ2YWx1ZSIsInBhcmFtZXRlciIsImhhc0NsYXNzIiwiY2FsbFF1ZXVlIiwiZGVmYXVsdEV4dGVuc2lvbiIsIiRudW1iZXIiLCIkZGlycnR5RmllbGQiLCJBdmFpbGFibGVNZW1iZXJzTGlzdCIsIiRmb3JtT2JqIiwiJGFjY29yZGlvbnMiLCIkZHJvcERvd25zIiwiJGVycm9yTWVzc2FnZXMiLCIkY2hlY2tCb3hlcyIsImZvcndhcmRpbmdTZWxlY3QiLCIkZGVsZXRlUm93QnV0dG9uIiwiJHBlcmlvZGljQW5ub3VuY2VEcm9wZG93biIsIm1lbWJlclJvdyIsIiRleHRlbnNpb25TZWxlY3REcm9wZG93biIsIiRleHRlbnNpb25zVGFibGUiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwiY3FfVmFsaWRhdGVOYW1lRW1wdHkiLCJleHRlbnNpb24iLCJjcV9WYWxpZGF0ZUV4dGVuc2lvbk51bWJlciIsImNxX1ZhbGlkYXRlRXh0ZW5zaW9uRW1wdHkiLCJjcV9WYWxpZGF0ZUV4dGVuc2lvbkRvdWJsZSIsImluaXRpYWxpemUiLCJFeHRlbnNpb25zIiwiZ2V0UGhvbmVFeHRlbnNpb25zIiwic2V0QXZhaWxhYmxlUXVldWVNZW1iZXJzIiwidmFsIiwiYWNjb3JkaW9uIiwiZHJvcGRvd24iLCJjaGVja2JveCIsIm9uQ2hhbmdlIiwicGFyc2VJbnQiLCJnZXREcm9wZG93blNldHRpbmdzV2l0aEVtcHR5IiwiZml4QnVnRHJvcGRvd25JY29uIiwib24iLCJuZXdOdW1iZXIiLCJjaGVja0F2YWlsYWJpbGl0eSIsImRlZmF1bHROdW1iZXIiLCJpbml0aWFsaXplRHJhZ0FuZERyb3BFeHRlbnNpb25UYWJsZVJvd3MiLCJlIiwidGFyZ2V0IiwiY2xvc2VzdCIsInJlbW92ZSIsInJlaW5pdGlhbGl6ZUV4dGVuc2lvblNlbGVjdCIsInVwZGF0ZUV4dGVuc2lvblRhYmxlVmlldyIsIk1hdGgiLCJyYW5kb20iLCJ0cmlnZ2VyIiwicHJldmVudERlZmF1bHQiLCJpbml0aWFsaXplRm9ybSIsImFyclJlc3VsdCIsImVhY2giLCJyZXN1bHRzIiwiaW5kZXgiLCJwdXNoIiwibnVtYmVyIiwiY2FsbGVyaWQiLCJnZXRBdmFpbGFibGVRdWV1ZU1lbWJlcnMiLCJyZXN1bHQiLCJmb3JFYWNoIiwibWVtYmVyIiwibGVuZ3RoIiwiYWN0aW9uIiwiZm9yY2VTZWxlY3Rpb24iLCJ0ZXh0IiwiJHRyIiwibGFzdCIsIiRjbG9uZSIsImNsb25lIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsInNob3ciLCJhdHRyIiwiZmluZCIsImh0bWwiLCJhZnRlciIsInZhbHVlcyIsInRhYmxlRG5EIiwib25EcmFnQ2xhc3MiLCJkcmFnSGFuZGxlIiwib25Ecm9wIiwiZHVtbXkiLCJjcV9BZGRRdWV1ZU1lbWJlcnMiLCJhcHBlbmQiLCJjYkJlZm9yZVNlbmRGb3JtIiwiZGF0YSIsImFyck1lbWJlcnMiLCJvYmoiLCJwcmlvcml0eSIsImNxX1ZhbGlkYXRlTm9FeHRlbnNpb25zIiwibWVtYmVycyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjYkFmdGVyU2VuZEZvcm0iLCJGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7O0FBUUE7QUFFQTtBQUNBQSxDQUFDLENBQUNDLEVBQUYsQ0FBS0MsSUFBTCxDQUFVQyxRQUFWLENBQW1CQyxLQUFuQixDQUF5QkMsU0FBekIsR0FBcUMsVUFBQ0MsS0FBRCxFQUFRQyxTQUFSO0FBQUEsU0FBc0JQLENBQUMsWUFBS08sU0FBTCxFQUFELENBQW1CQyxRQUFuQixDQUE0QixRQUE1QixDQUF0QjtBQUFBLENBQXJDOztBQUVBLElBQU1DLFNBQVMs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QUFTLENBQUN5RixnQkFBbEM7QUFDQVUsTUFBQUEsSUFBSSxDQUFDRCxlQUFMLEdBQXVCbEcsU0FBUyxDQUFDa0csZUFBakM7QUFDQUMsTUFBQUEsSUFBSSxDQUFDeEUsVUFBTDtBQUNBOztBQTlMZ0I7QUFBQTtBQUFBLENBQWxCO0FBaU1BcEMsQ0FBQyxDQUFDK0csUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUN2QnZHLEVBQUFBLFNBQVMsQ0FBQzJCLFVBQVY7QUFDQSxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoQykgTUlLTyBMTEMgLSBBbGwgUmlnaHRzIFJlc2VydmVkXG4gKiBVbmF1dGhvcml6ZWQgY29weWluZyBvZiB0aGlzIGZpbGUsIHZpYSBhbnkgbWVkaXVtIGlzIHN0cmljdGx5IHByb2hpYml0ZWRcbiAqIFByb3ByaWV0YXJ5IGFuZCBjb25maWRlbnRpYWxcbiAqIFdyaXR0ZW4gYnkgTmlrb2xheSBCZWtldG92LCAxMiAyMDE5XG4gKlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLCBnbG9iYWxUcmFuc2xhdGUsIEV4dGVuc2lvbnMsRm9ybSAgKi9cblxuLy8g0J/RgNC+0LLQtdGA0LrQsCDQvdC10YIg0LvQuCDQvtGI0LjQsdC60Lgg0LfQsNC90Y/RgtC+0LPQviDQtNGA0YPQs9C+0Lkg0YPRh9C10YLQutC+0Lkg0L3QvtC80LXRgNCwXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuZXhpc3RSdWxlID0gKHZhbHVlLCBwYXJhbWV0ZXIpID0+ICQoYCMke3BhcmFtZXRlcn1gKS5oYXNDbGFzcygnaGlkZGVuJyk7XG5cbmNvbnN0IGNhbGxRdWV1ZSA9IHtcblx0ZGVmYXVsdEV4dGVuc2lvbjogJycsXG5cdCRudW1iZXI6ICQoJyNleHRlbnNpb24nKSxcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdEF2YWlsYWJsZU1lbWJlcnNMaXN0OiBbXSxcblx0JGZvcm1PYmo6ICQoJyNxdWV1ZS1mb3JtJyksXG5cdCRhY2NvcmRpb25zOiAkKCcjcXVldWUtZm9ybSAudWkuYWNjb3JkaW9uJyksXG5cdCRkcm9wRG93bnM6ICQoJyNxdWV1ZS1mb3JtIC5kcm9wZG93bicpLFxuXHQkZXJyb3JNZXNzYWdlczogJCgnI2Zvcm0tZXJyb3ItbWVzc2FnZXMnKSxcblx0JGNoZWNrQm94ZXM6ICQoJyNxdWV1ZS1mb3JtIC5jaGVja2JveCcpLFxuXHRmb3J3YXJkaW5nU2VsZWN0OiAnI3F1ZXVlLWZvcm0gLmZvcndhcmRpbmctc2VsZWN0Jyxcblx0JGRlbGV0ZVJvd0J1dHRvbjogJCgnLmRlbGV0ZS1yb3ctYnV0dG9uJyksXG5cdCRwZXJpb2RpY0Fubm91bmNlRHJvcGRvd246ICQoJyNxdWV1ZS1mb3JtIC5wZXJpb2RpYy1hbm5vdW5jZS1zb3VuZC1pZC1zZWxlY3QnKSxcblx0bWVtYmVyUm93OiAnI3F1ZXVlLWZvcm0gLm1lbWJlci1yb3cnLFxuXHQkZXh0ZW5zaW9uU2VsZWN0RHJvcGRvd246ICQoJyNleHRlbnNpb25zZWxlY3QnKSxcblx0JGV4dGVuc2lvbnNUYWJsZTogJCgnI2V4dGVuc2lvbnNUYWJsZScpLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0bmFtZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ25hbWUnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3FfVmFsaWRhdGVOYW1lRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0ZXh0ZW5zaW9uOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnZXh0ZW5zaW9uJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnbnVtYmVyJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jcV9WYWxpZGF0ZUV4dGVuc2lvbk51bWJlcixcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3FfVmFsaWRhdGVFeHRlbnNpb25FbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdleGlzdFJ1bGVbZXh0ZW5zaW9uLWVycm9yXScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3FfVmFsaWRhdGVFeHRlbnNpb25Eb3VibGUsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0RXh0ZW5zaW9ucy5nZXRQaG9uZUV4dGVuc2lvbnMoY2FsbFF1ZXVlLnNldEF2YWlsYWJsZVF1ZXVlTWVtYmVycyk7XG5cdFx0Y2FsbFF1ZXVlLmRlZmF1bHRFeHRlbnNpb24gPSAkKCcjZXh0ZW5zaW9uJykudmFsKCk7XG5cdFx0Y2FsbFF1ZXVlLiRhY2NvcmRpb25zLmFjY29yZGlvbigpO1xuXHRcdGNhbGxRdWV1ZS4kZHJvcERvd25zLmRyb3Bkb3duKCk7XG5cdFx0Y2FsbFF1ZXVlLiRjaGVja0JveGVzLmNoZWNrYm94KCk7XG5cdFx0Y2FsbFF1ZXVlLiRwZXJpb2RpY0Fubm91bmNlRHJvcGRvd24uZHJvcGRvd24oe1xuXHRcdFx0b25DaGFuZ2UodmFsdWUpIHtcblx0XHRcdFx0aWYgKHBhcnNlSW50KHZhbHVlLCAxMCkgPT09IC0xKSB7XG5cdFx0XHRcdFx0Y2FsbFF1ZXVlLiRwZXJpb2RpY0Fubm91bmNlRHJvcGRvd24uZHJvcGRvd24oJ2NsZWFyJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0fSk7XG5cdFx0JChjYWxsUXVldWUuZm9yd2FyZGluZ1NlbGVjdCkuZHJvcGRvd24oRXh0ZW5zaW9ucy5nZXREcm9wZG93blNldHRpbmdzV2l0aEVtcHR5KCkpO1xuXHRcdEV4dGVuc2lvbnMuZml4QnVnRHJvcGRvd25JY29uKCk7XG5cdFx0Ly8g0JTQuNC90LDQvNC40YfQtdGB0LrQsNGPINC/0YDQvtCy0L7QstC10YDQutCwINGB0LLQvtCx0L7QtNC10L0g0LvQuCDQstC90YPRgtGA0LXQvdC90LjQuSDQvdC+0LzQtdGAXG5cdFx0Y2FsbFF1ZXVlLiRudW1iZXIub24oJ2NoYW5nZScsICgpID0+IHtcblx0XHRcdGNvbnN0IG5ld051bWJlciA9IGNhbGxRdWV1ZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZXh0ZW5zaW9uJyk7XG5cdFx0XHRFeHRlbnNpb25zLmNoZWNrQXZhaWxhYmlsaXR5KGNhbGxRdWV1ZS5kZWZhdWx0TnVtYmVyLCBuZXdOdW1iZXIpO1xuXHRcdH0pO1xuXG5cdFx0Y2FsbFF1ZXVlLmluaXRpYWxpemVEcmFnQW5kRHJvcEV4dGVuc2lvblRhYmxlUm93cygpO1xuXG5cdFx0Ly8g0KPQtNCw0LvQtdC90LjQtSDRgdGC0YDQvtC60Lgg0LjQtyDRgtCw0LHQu9C40YbRiyDRg9GH0LDRgdGC0L3QuNC60L7QsiDQvtGH0LXRgNC10LTQuFxuXHRcdGNhbGxRdWV1ZS4kZGVsZXRlUm93QnV0dG9uLm9uKCdjbGljaycsIChlKSA9PiB7XG5cdFx0XHQkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLnJlbW92ZSgpO1xuXHRcdFx0Y2FsbFF1ZXVlLnJlaW5pdGlhbGl6ZUV4dGVuc2lvblNlbGVjdCgpO1xuXHRcdFx0Y2FsbFF1ZXVlLnVwZGF0ZUV4dGVuc2lvblRhYmxlVmlldygpO1xuXHRcdFx0Y2FsbFF1ZXVlLiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRjYWxsUXVldWUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0pO1xuXG5cdFx0Y2FsbFF1ZXVlLmluaXRpYWxpemVGb3JtKCk7XG5cdH0sXG5cdHNldEF2YWlsYWJsZVF1ZXVlTWVtYmVycyhhcnJSZXN1bHQpIHtcblx0XHQkLmVhY2goYXJyUmVzdWx0LnJlc3VsdHMsIChpbmRleCwgZXh0ZW5zaW9uKSA9PiB7XG5cdFx0XHRjYWxsUXVldWUuQXZhaWxhYmxlTWVtYmVyc0xpc3QucHVzaCh7XG5cdFx0XHRcdG51bWJlcjogZXh0ZW5zaW9uLnZhbHVlLFxuXHRcdFx0XHRjYWxsZXJpZDogZXh0ZW5zaW9uLm5hbWUsXG5cdFx0XHR9KTtcblx0XHR9KTtcblx0XHRjYWxsUXVldWUucmVpbml0aWFsaXplRXh0ZW5zaW9uU2VsZWN0KCk7XG5cdFx0Y2FsbFF1ZXVlLnVwZGF0ZUV4dGVuc2lvblRhYmxlVmlldygpO1xuXHR9LFxuXHQvLyDQktC10YDQvdGD0YLRjCDRgdC/0LjRgdC+0Log0LTQvtGB0YLRg9C/0L3Ri9GFINGH0LvQtdC90L7QsiDQvtGH0LXRgNC10LTQuFxuXHRnZXRBdmFpbGFibGVRdWV1ZU1lbWJlcnMoKSB7XG5cdFx0Y29uc3QgcmVzdWx0ID0gW107XG5cdFx0Y2FsbFF1ZXVlLkF2YWlsYWJsZU1lbWJlcnNMaXN0LmZvckVhY2goKG1lbWJlcikgPT4ge1xuXHRcdFx0aWYgKCQoYC5tZW1iZXItcm93IyR7bWVtYmVyLm51bWJlcn1gKS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0cmVzdWx0LnB1c2goe1xuXHRcdFx0XHRcdG5hbWU6IG1lbWJlci5jYWxsZXJpZCxcblx0XHRcdFx0XHR2YWx1ZTogbWVtYmVyLm51bWJlcixcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0Ly8gcmVzdWx0LnNvcnQoKGEsIGIpID0+ICgoYS5uYW1lID4gYi5uYW1lKSA/IDEgOiAoKGIubmFtZSA+IGEubmFtZSkgPyAtMSA6IDApKSk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblx0Ly8g0J/QtdGA0LXRgdC+0LHRgNCw0YLRjCDRh9C70LXQvdC+0LIg0L7Rh9C10YDQtdC00Lgg0YEg0YPRh9C10YLQvtC8INGD0LbQtSDQstGL0LHRgNCw0L3QvdGL0YVcblx0cmVpbml0aWFsaXplRXh0ZW5zaW9uU2VsZWN0KCkge1xuXHRcdGNhbGxRdWV1ZS4kZXh0ZW5zaW9uU2VsZWN0RHJvcGRvd24uZHJvcGRvd24oe1xuXHRcdFx0YWN0aW9uOiAnaGlkZScsXG5cdFx0XHRmb3JjZVNlbGVjdGlvbjogZmFsc2UsXG5cdFx0XHRvbkNoYW5nZSh2YWx1ZSwgdGV4dCkge1xuXHRcdFx0XHRpZiAodmFsdWUpIHtcblx0XHRcdFx0XHRjb25zdCAkdHIgPSAkKCcubWVtYmVyLXJvdy10cGwnKS5sYXN0KCk7XG5cdFx0XHRcdFx0Y29uc3QgJGNsb25lID0gJHRyLmNsb25lKHRydWUpO1xuXHRcdFx0XHRcdCRjbG9uZVxuXHRcdFx0XHRcdFx0LnJlbW92ZUNsYXNzKCdtZW1iZXItcm93LXRwbCcpXG5cdFx0XHRcdFx0XHQuYWRkQ2xhc3MoJ21lbWJlci1yb3cnKVxuXHRcdFx0XHRcdFx0LnNob3coKTtcblx0XHRcdFx0XHQkY2xvbmUuYXR0cignaWQnLCB2YWx1ZSk7XG5cdFx0XHRcdFx0JGNsb25lLmZpbmQoJy5udW1iZXInKS5odG1sKHZhbHVlKTtcblx0XHRcdFx0XHQkY2xvbmUuZmluZCgnLmNhbGxlcmlkJykuaHRtbCh0ZXh0KTtcblx0XHRcdFx0XHRpZiAoJChjYWxsUXVldWUubWVtYmVyUm93KS5sYXN0KCkubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdFx0XHQkdHIuYWZ0ZXIoJGNsb25lKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0JChjYWxsUXVldWUubWVtYmVyUm93KS5sYXN0KCkuYWZ0ZXIoJGNsb25lKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRjYWxsUXVldWUucmVpbml0aWFsaXplRXh0ZW5zaW9uU2VsZWN0KCk7XG5cdFx0XHRcdFx0Y2FsbFF1ZXVlLnVwZGF0ZUV4dGVuc2lvblRhYmxlVmlldygpO1xuXHRcdFx0XHRcdGNhbGxRdWV1ZS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRcdGNhbGxRdWV1ZS4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHR2YWx1ZXM6IGNhbGxRdWV1ZS5nZXRBdmFpbGFibGVRdWV1ZU1lbWJlcnMoKSxcblxuXHRcdH0pO1xuXHR9LCAvLyDQktC60LvRjtGH0LjRgtGMINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjRjyDRjdC70LXQvNC10L3RgtC+0LIg0YLQsNCx0LvQuNGG0Ysg0YPRh9Cw0YHRgtC90LjQutC+0LIg0L7Rh9C10YDQtdC00LhcblxuXHRpbml0aWFsaXplRHJhZ0FuZERyb3BFeHRlbnNpb25UYWJsZVJvd3MoKSB7XG5cdFx0Y2FsbFF1ZXVlLiRleHRlbnNpb25zVGFibGUudGFibGVEbkQoe1xuXHRcdFx0b25EcmFnQ2xhc3M6ICdob3ZlcmluZ1JvdycsXG5cdFx0XHRkcmFnSGFuZGxlOiAnLmRyYWdIYW5kbGUnLFxuXHRcdFx0b25Ecm9wOiAoKSA9PiB7XG5cdFx0XHRcdGNhbGxRdWV1ZS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRjYWxsUXVldWUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0fSxcblx0XHR9KTtcblx0fSxcblxuXHQvLyDQntGC0L7QsdGA0LDQt9C40YLRjCDQt9Cw0LPQu9GD0YjQutGDINC10YHQu9C4INCyINGC0LDQsdC70LjRhtC1IDAg0YHRgtGA0L7QulxuXHR1cGRhdGVFeHRlbnNpb25UYWJsZVZpZXcoKSB7XG5cdFx0Y29uc3QgZHVtbXkgPSBgPHRyIGNsYXNzPVwiZHVtbXlcIj48dGQgY29sc3Bhbj1cIjRcIiBjbGFzcz1cImNlbnRlciBhbGlnbmVkXCI+JHtnbG9iYWxUcmFuc2xhdGUuY3FfQWRkUXVldWVNZW1iZXJzfTwvdGQ+PC90cj5gO1xuXG5cdFx0aWYgKCQoY2FsbFF1ZXVlLm1lbWJlclJvdykubGVuZ3RoID09PSAwKSB7XG5cdFx0XHQkKCcjZXh0ZW5zaW9uc1RhYmxlIHRib2R5JykuYXBwZW5kKGR1bW15KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0JCgnI2V4dGVuc2lvbnNUYWJsZSB0Ym9keSAuZHVtbXknKS5yZW1vdmUoKTtcblx0XHR9XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRsZXQgcmVzdWx0ID0gc2V0dGluZ3M7XG5cdFx0cmVzdWx0LmRhdGEgPSBjYWxsUXVldWUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdGNvbnN0IGFyck1lbWJlcnMgPSBbXTtcblx0XHQkKCcjcXVldWUtZm9ybSAubWVtYmVyLXJvdycpLmVhY2goKGluZGV4LCBvYmopID0+IHtcblx0XHRcdGlmICgkKG9iaikuYXR0cignaWQnKSkge1xuXHRcdFx0XHRhcnJNZW1iZXJzLnB1c2goe1xuXHRcdFx0XHRcdG51bWJlcjogJChvYmopLmF0dHIoJ2lkJyksXG5cdFx0XHRcdFx0cHJpb3JpdHk6IGluZGV4LFxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRpZiAoYXJyTWVtYmVycy5sZW5ndGggPT09IDApIHtcblx0XHRcdHJlc3VsdCA9IGZhbHNlO1xuXHRcdFx0Y2FsbFF1ZXVlLiRlcnJvck1lc3NhZ2VzLmh0bWwoZ2xvYmFsVHJhbnNsYXRlLmNxX1ZhbGlkYXRlTm9FeHRlbnNpb25zKTtcblx0XHRcdGNhbGxRdWV1ZS4kZm9ybU9iai5hZGRDbGFzcygnZXJyb3InKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmVzdWx0LmRhdGEubWVtYmVycyA9IEpTT04uc3RyaW5naWZ5KGFyck1lbWJlcnMpO1xuXHRcdH1cblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdGNiQWZ0ZXJTZW5kRm9ybSgpIHtcblx0XHRjYWxsUXVldWUuZGVmYXVsdE51bWJlciA9IGNhbGxRdWV1ZS4kbnVtYmVyLnZhbCgpO1xuXHR9LFxuXHRpbml0aWFsaXplRm9ybSgpIHtcblx0XHRGb3JtLiRmb3JtT2JqID0gY2FsbFF1ZXVlLiRmb3JtT2JqO1xuXHRcdEZvcm0udXJsID0gYCR7Z2xvYmFsUm9vdFVybH1jYWxsLXF1ZXVlcy9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBjYWxsUXVldWUudmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBjYWxsUXVldWUuY2JCZWZvcmVTZW5kRm9ybTtcblx0XHRGb3JtLmNiQWZ0ZXJTZW5kRm9ybSA9IGNhbGxRdWV1ZS5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG5cdGNhbGxRdWV1ZS5pbml0aWFsaXplKCk7XG59KTtcblxuIl19