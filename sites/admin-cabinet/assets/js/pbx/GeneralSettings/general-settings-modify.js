"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl,globalTranslate, Form, PasswordScore, PbxApi, UserMessage */
var generalSettingsModify = {
  $dirrtyField: $('#dirrty'),
  $formObj: $('#general-settings-form'),
  $webAdminPassword: $('#WebAdminPassword'),
  $sshPassword: $('#SSHPassword'),
  validateRules: {
    pbxname: {
      identifier: 'PBXName',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.gs_ValidateEmptyPBXName
      }]
    },
    WebAdminPassword: {
      identifier: 'WebAdminPassword',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.gs_ValidateEmptyWebPassword
      }, {
        type: 'minLength[5]',
        prompt: globalTranslate.gs_ValidateWeakWebPassword
      }]
    },
    WebAdminPasswordRepeat: {
      identifier: 'WebAdminPasswordRepeat',
      rules: [{
        type: 'match[WebAdminPassword]',
        prompt: globalTranslate.gs_ValidateWebPasswordsFieldDifferent
      }]
    },
    SSHPassword: {
      identifier: 'SSHPassword',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.gs_ValidateEmptySSHPassword
      }, {
        type: 'minLength[5]',
        prompt: globalTranslate.gs_ValidateWeakSSHPassword
      }]
    },
    SSHPasswordRepeat: {
      identifier: 'SSHPasswordRepeat',
      rules: [{
        type: 'match[SSHPassword]',
        prompt: globalTranslate.gs_ValidateSSHPasswordsFieldDifferent
      }]
    },
    WEBPort: {
      identifier: 'WEBPort',
      rules: [{
        type: 'integer[1..65535]',
        prompt: globalTranslate.gs_ValidateWEBPortOutOfRange
      }]
    },
    WEBHTTPSPort: {
      identifier: 'WEBHTTPSPort',
      rules: [{
        type: 'integer[1..65535]',
        prompt: globalTranslate.gs_ValidateWEBHTTPSPortOutOfRange
      }, {
        type: 'different[WEBPort]',
        prompt: globalTranslate.gs_ValidateWEBHTTPSPortNotEqualToWEBPort
      }]
    }
  },
  initialize: function () {
    function initialize() {
      generalSettingsModify.$webAdminPassword.on('keyup', function () {
        PasswordScore.checkPassStrength({
          pass: generalSettingsModify.$webAdminPassword.val(),
          bar: $('.password-score'),
          section: $('.password-score-section')
        });
      });
      generalSettingsModify.$sshPassword.on('keyup', function () {
        PasswordScore.checkPassStrength({
          pass: generalSettingsModify.$sshPassword.val(),
          bar: $('.ssh-password-score'),
          section: $('.ssh-password-score-section')
        });
      });
      $('#general-settings-menu').find('.item').tab({
        history: true,
        historyType: 'hash'
      });
      $('#general-settings-form .checkbox').checkbox();
      $('#general-settings-form .dropdown').dropdown();
      $('#audio-codecs-table, #video-codecs-table').tableDnD({
        onDrop: function () {
          function onDrop() {
            generalSettingsModify.$dirrtyField.val(Math.random());
            generalSettingsModify.$dirrtyField.trigger('change');
          }

          return onDrop;
        }(),
        onDragClass: 'hoveringRow',
        dragHandle: '.dragHandle'
      });
      generalSettingsModify.initializeForm();
    }

    return initialize;
  }(),
  checkDeleteAllConditions: function () {
    function checkDeleteAllConditions() {
      var deleteAllInput = generalSettingsModify.$formObj.form('get value', 'deleteAllInput');

      if (deleteAllInput === globalTranslate.gs_EnterDeleteAllPhrase) {
        PbxApi.SystemRestoreDefaultSettings(generalSettingsModify.cbAfterRestoreDefaultSettings);
      }
    }

    return checkDeleteAllConditions;
  }(),
  cbAfterRestoreDefaultSettings: function () {
    function cbAfterRestoreDefaultSettings(response) {
      if (response === true) {
        UserMessage.showInformation(globalTranslate.gs_AllSettingsDeleted);
      } else {
        UserMessage.showMultiString(response);
      }
    }

    return cbAfterRestoreDefaultSettings;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = generalSettingsModify.$formObj.form('get values');
      var arrCodecs = [];
      $('#audio-codecs-table .codec-row, #video-codecs-table .codec-row').each(function (index, obj) {
        if ($(obj).attr('id')) {
          arrCodecs.push({
            codecId: $(obj).attr('id'),
            disabled: $(obj).find('.checkbox').checkbox('is unchecked'),
            priority: index
          });
        }
      });
      result.data.codecs = JSON.stringify(arrCodecs);
      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {
      generalSettingsModify.checkDeleteAllConditions();
    }

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = generalSettingsModify.$formObj;
      Form.url = "".concat(globalRootUrl, "general-settings/save");
      Form.validateRules = generalSettingsModify.validateRules;
      Form.cbBeforeSendForm = generalSettingsModify.cbBeforeSendForm;
      Form.cbAfterSendForm = generalSettingsModify.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  generalSettingsModify.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9HZW5lcmFsU2V0dGluZ3MvZ2VuZXJhbC1zZXR0aW5ncy1tb2RpZnkuanMiXSwibmFtZXMiOlsiZ2VuZXJhbFNldHRpbmdzTW9kaWZ5IiwiJGRpcnJ0eUZpZWxkIiwiJCIsIiRmb3JtT2JqIiwiJHdlYkFkbWluUGFzc3dvcmQiLCIkc3NoUGFzc3dvcmQiLCJ2YWxpZGF0ZVJ1bGVzIiwicGJ4bmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJnc19WYWxpZGF0ZUVtcHR5UEJYTmFtZSIsIldlYkFkbWluUGFzc3dvcmQiLCJnc19WYWxpZGF0ZUVtcHR5V2ViUGFzc3dvcmQiLCJnc19WYWxpZGF0ZVdlYWtXZWJQYXNzd29yZCIsIldlYkFkbWluUGFzc3dvcmRSZXBlYXQiLCJnc19WYWxpZGF0ZVdlYlBhc3N3b3Jkc0ZpZWxkRGlmZmVyZW50IiwiU1NIUGFzc3dvcmQiLCJnc19WYWxpZGF0ZUVtcHR5U1NIUGFzc3dvcmQiLCJnc19WYWxpZGF0ZVdlYWtTU0hQYXNzd29yZCIsIlNTSFBhc3N3b3JkUmVwZWF0IiwiZ3NfVmFsaWRhdGVTU0hQYXNzd29yZHNGaWVsZERpZmZlcmVudCIsIldFQlBvcnQiLCJnc19WYWxpZGF0ZVdFQlBvcnRPdXRPZlJhbmdlIiwiV0VCSFRUUFNQb3J0IiwiZ3NfVmFsaWRhdGVXRUJIVFRQU1BvcnRPdXRPZlJhbmdlIiwiZ3NfVmFsaWRhdGVXRUJIVFRQU1BvcnROb3RFcXVhbFRvV0VCUG9ydCIsImluaXRpYWxpemUiLCJvbiIsIlBhc3N3b3JkU2NvcmUiLCJjaGVja1Bhc3NTdHJlbmd0aCIsInBhc3MiLCJ2YWwiLCJiYXIiLCJzZWN0aW9uIiwiZmluZCIsInRhYiIsImhpc3RvcnkiLCJoaXN0b3J5VHlwZSIsImNoZWNrYm94IiwiZHJvcGRvd24iLCJ0YWJsZURuRCIsIm9uRHJvcCIsIk1hdGgiLCJyYW5kb20iLCJ0cmlnZ2VyIiwib25EcmFnQ2xhc3MiLCJkcmFnSGFuZGxlIiwiaW5pdGlhbGl6ZUZvcm0iLCJjaGVja0RlbGV0ZUFsbENvbmRpdGlvbnMiLCJkZWxldGVBbGxJbnB1dCIsImZvcm0iLCJnc19FbnRlckRlbGV0ZUFsbFBocmFzZSIsIlBieEFwaSIsIlN5c3RlbVJlc3RvcmVEZWZhdWx0U2V0dGluZ3MiLCJjYkFmdGVyUmVzdG9yZURlZmF1bHRTZXR0aW5ncyIsInJlc3BvbnNlIiwiVXNlck1lc3NhZ2UiLCJzaG93SW5mb3JtYXRpb24iLCJnc19BbGxTZXR0aW5nc0RlbGV0ZWQiLCJzaG93TXVsdGlTdHJpbmciLCJjYkJlZm9yZVNlbmRGb3JtIiwic2V0dGluZ3MiLCJyZXN1bHQiLCJkYXRhIiwiYXJyQ29kZWNzIiwiZWFjaCIsImluZGV4Iiwib2JqIiwiYXR0ciIsInB1c2giLCJjb2RlY0lkIiwiZGlzYWJsZWQiLCJwcmlvcml0eSIsImNvZGVjcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjYkFmdGVyU2VuZEZvcm0iLCJGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1CQTtBQUVBLElBQU1BLHFCQUFxQixHQUFHO0FBQzdCQyxFQUFBQSxZQUFZLEVBQUVDLENBQUMsQ0FBQyxTQUFELENBRGM7QUFFN0JDLEVBQUFBLFFBQVEsRUFBRUQsQ0FBQyxDQUFDLHdCQUFELENBRmtCO0FBRzdCRSxFQUFBQSxpQkFBaUIsRUFBRUYsQ0FBQyxDQUFDLG1CQUFELENBSFM7QUFJN0JHLEVBQUFBLFlBQVksRUFBRUgsQ0FBQyxDQUFDLGNBQUQsQ0FKYztBQUs3QkksRUFBQUEsYUFBYSxFQUFFO0FBQ2RDLElBQUFBLE9BQU8sRUFBRTtBQUNSQyxNQUFBQSxVQUFVLEVBQUUsU0FESjtBQUVSQyxNQUFBQSxLQUFLLEVBQUUsQ0FDTjtBQUNDQyxRQUFBQSxJQUFJLEVBQUUsT0FEUDtBQUVDQyxRQUFBQSxNQUFNLEVBQUVDLGVBQWUsQ0FBQ0M7QUFGekIsT0FETTtB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QjtBQUFBLCtCQWlKWDtBQUNqQi9FLE1BQUFBLHFCQUFxQixDQUFDbUQsd0JBQXRCO0FBRUE7O0FBcEo0QjtBQUFBO0FBcUo3QkQsRUFBQUEsY0FySjZCO0FBQUEsOEJBcUpaO0FBQ2hCOEIsTUFBQUEsSUFBSSxDQUFDN0UsUUFBTCxHQUFnQkgscUJBQXFCLENBQUNHLFFBQXRDO0FBQ0E2RSxNQUFBQSxJQUFJLENBQUNDLEdBQUwsYUFBY0MsYUFBZDtBQUNBRixNQUFBQSxJQUFJLENBQUMxRSxhQUFMLEdBQXFCTixxQkFBcUIsQ0FBQ00sYUFBM0M7QUFDQTBFLE1BQUFBLElBQUksQ0FBQ2pCLGdCQUFMLEdBQXdCL0QscUJBQXFCLENBQUMrRCxnQkFBOUM7QUFDQWlCLE1BQUFBLElBQUksQ0FBQ0QsZUFBTCxHQUF1Qi9FLHFCQUFxQixDQUFDK0UsZUFBN0M7QUFDQUMsTUFBQUEsSUFBSSxDQUFDbkQsVUFBTDtBQUNBOztBQTVKNEI7QUFBQTtBQUFBLENBQTlCO0FBK0pBM0IsQ0FBQyxDQUFDaUYsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUN2QnBGLEVBQUFBLHFCQUFxQixDQUFDNkIsVUFBdEI7QUFDQSxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCAoQykgMjAxNy0yMDIwIEFsZXhleSBQb3J0bm92IGFuZCBOaWtvbGF5IEJla2V0b3ZcbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uXG4gKiBJZiBub3QsIHNlZSA8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICovXG5cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsZ2xvYmFsVHJhbnNsYXRlLCBGb3JtLCBQYXNzd29yZFNjb3JlLCBQYnhBcGksIFVzZXJNZXNzYWdlICovXG5cbmNvbnN0IGdlbmVyYWxTZXR0aW5nc01vZGlmeSA9IHtcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdCRmb3JtT2JqOiAkKCcjZ2VuZXJhbC1zZXR0aW5ncy1mb3JtJyksXG5cdCR3ZWJBZG1pblBhc3N3b3JkOiAkKCcjV2ViQWRtaW5QYXNzd29yZCcpLFxuXHQkc3NoUGFzc3dvcmQ6ICQoJyNTU0hQYXNzd29yZCcpLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0cGJ4bmFtZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ1BCWE5hbWUnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVFbXB0eVBCWE5hbWUsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0V2ViQWRtaW5QYXNzd29yZDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ1dlYkFkbWluUGFzc3dvcmQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVFbXB0eVdlYlBhc3N3b3JkLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ21pbkxlbmd0aFs1XScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVXZWFrV2ViUGFzc3dvcmQsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0V2ViQWRtaW5QYXNzd29yZFJlcGVhdDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ1dlYkFkbWluUGFzc3dvcmRSZXBlYXQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdtYXRjaFtXZWJBZG1pblBhc3N3b3JkXScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVXZWJQYXNzd29yZHNGaWVsZERpZmZlcmVudCxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRTU0hQYXNzd29yZDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ1NTSFBhc3N3b3JkJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlRW1wdHlTU0hQYXNzd29yZCxcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdtaW5MZW5ndGhbNV0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlV2Vha1NTSFBhc3N3b3JkLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdFNTSFBhc3N3b3JkUmVwZWF0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnU1NIUGFzc3dvcmRSZXBlYXQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdtYXRjaFtTU0hQYXNzd29yZF0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlU1NIUGFzc3dvcmRzRmllbGREaWZmZXJlbnQsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0V0VCUG9ydDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ1dFQlBvcnQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdpbnRlZ2VyWzEuLjY1NTM1XScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVXRUJQb3J0T3V0T2ZSYW5nZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRXRUJIVFRQU1BvcnQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdXRUJIVFRQU1BvcnQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdpbnRlZ2VyWzEuLjY1NTM1XScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVXRUJIVFRQU1BvcnRPdXRPZlJhbmdlLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2RpZmZlcmVudFtXRUJQb3J0XScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuZ3NfVmFsaWRhdGVXRUJIVFRQU1BvcnROb3RFcXVhbFRvV0VCUG9ydCxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0fSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHRnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJHdlYkFkbWluUGFzc3dvcmQub24oJ2tleXVwJywgKCkgPT4ge1xuXHRcdFx0UGFzc3dvcmRTY29yZS5jaGVja1Bhc3NTdHJlbmd0aCh7XG5cdFx0XHRcdHBhc3M6IGdlbmVyYWxTZXR0aW5nc01vZGlmeS4kd2ViQWRtaW5QYXNzd29yZC52YWwoKSxcblx0XHRcdFx0YmFyOiAkKCcucGFzc3dvcmQtc2NvcmUnKSxcblx0XHRcdFx0c2VjdGlvbjogJCgnLnBhc3N3b3JkLXNjb3JlLXNlY3Rpb24nKSxcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHRcdGdlbmVyYWxTZXR0aW5nc01vZGlmeS4kc3NoUGFzc3dvcmQub24oJ2tleXVwJywgKCkgPT4ge1xuXHRcdFx0UGFzc3dvcmRTY29yZS5jaGVja1Bhc3NTdHJlbmd0aCh7XG5cdFx0XHRcdHBhc3M6IGdlbmVyYWxTZXR0aW5nc01vZGlmeS4kc3NoUGFzc3dvcmQudmFsKCksXG5cdFx0XHRcdGJhcjogJCgnLnNzaC1wYXNzd29yZC1zY29yZScpLFxuXHRcdFx0XHRzZWN0aW9uOiAkKCcuc3NoLXBhc3N3b3JkLXNjb3JlLXNlY3Rpb24nKSxcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHRcdCQoJyNnZW5lcmFsLXNldHRpbmdzLW1lbnUnKS5maW5kKCcuaXRlbScpLnRhYih7XG5cdFx0XHRoaXN0b3J5OiB0cnVlLFxuXHRcdFx0aGlzdG9yeVR5cGU6ICdoYXNoJyxcblx0XHR9KTtcblx0XHQkKCcjZ2VuZXJhbC1zZXR0aW5ncy1mb3JtIC5jaGVja2JveCcpLmNoZWNrYm94KCk7XG5cdFx0JCgnI2dlbmVyYWwtc2V0dGluZ3MtZm9ybSAuZHJvcGRvd24nKS5kcm9wZG93bigpO1xuXG5cdFx0JCgnI2F1ZGlvLWNvZGVjcy10YWJsZSwgI3ZpZGVvLWNvZGVjcy10YWJsZScpLnRhYmxlRG5EKHtcblx0XHRcdG9uRHJvcCgpIHtcblx0XHRcdFx0Z2VuZXJhbFNldHRpbmdzTW9kaWZ5LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdGdlbmVyYWxTZXR0aW5nc01vZGlmeS4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHR9LFxuXHRcdFx0b25EcmFnQ2xhc3M6ICdob3ZlcmluZ1JvdycsXG5cdFx0XHRkcmFnSGFuZGxlOiAnLmRyYWdIYW5kbGUnLFxuXHRcdH0pO1xuXHRcdGdlbmVyYWxTZXR0aW5nc01vZGlmeS5pbml0aWFsaXplRm9ybSgpO1xuXHR9LFxuXHRjaGVja0RlbGV0ZUFsbENvbmRpdGlvbnMoKXtcblx0XHRjb25zdCBkZWxldGVBbGxJbnB1dCA9IGdlbmVyYWxTZXR0aW5nc01vZGlmeS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZGVsZXRlQWxsSW5wdXQnKTtcblx0XHRpZiAoZGVsZXRlQWxsSW5wdXQgPT09IGdsb2JhbFRyYW5zbGF0ZS5nc19FbnRlckRlbGV0ZUFsbFBocmFzZSl7XG5cdFx0XHRQYnhBcGkuU3lzdGVtUmVzdG9yZURlZmF1bHRTZXR0aW5ncyhnZW5lcmFsU2V0dGluZ3NNb2RpZnkuY2JBZnRlclJlc3RvcmVEZWZhdWx0U2V0dGluZ3MpO1xuXHRcdH1cblxuXHR9LFxuXHRjYkFmdGVyUmVzdG9yZURlZmF1bHRTZXR0aW5ncyhyZXNwb25zZSl7XG5cdFx0aWYgKHJlc3BvbnNlPT09dHJ1ZSl7XG5cdFx0XHRVc2VyTWVzc2FnZS5zaG93SW5mb3JtYXRpb24oZ2xvYmFsVHJhbnNsYXRlLmdzX0FsbFNldHRpbmdzRGVsZXRlZCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdFVzZXJNZXNzYWdlLnNob3dNdWx0aVN0cmluZyhyZXNwb25zZSk7XG5cdFx0fVxuXHR9LFxuXHRjYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKSB7XG5cdFx0Y29uc3QgcmVzdWx0ID0gc2V0dGluZ3M7XG5cdFx0cmVzdWx0LmRhdGEgPSBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdGNvbnN0IGFyckNvZGVjcyA9IFtdO1xuXHRcdCQoJyNhdWRpby1jb2RlY3MtdGFibGUgLmNvZGVjLXJvdywgI3ZpZGVvLWNvZGVjcy10YWJsZSAuY29kZWMtcm93JykuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuXHRcdFx0aWYgKCQob2JqKS5hdHRyKCdpZCcpKSB7XG5cdFx0XHRcdGFyckNvZGVjcy5wdXNoKHtcblx0XHRcdFx0XHRjb2RlY0lkOiAkKG9iaikuYXR0cignaWQnKSxcblx0XHRcdFx0XHRkaXNhYmxlZDogJChvYmopLmZpbmQoJy5jaGVja2JveCcpLmNoZWNrYm94KCdpcyB1bmNoZWNrZWQnKSxcblx0XHRcdFx0XHRwcmlvcml0eTogaW5kZXgsXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdHJlc3VsdC5kYXRhLmNvZGVjcyA9IEpTT04uc3RyaW5naWZ5KGFyckNvZGVjcyk7XG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHRjYkFmdGVyU2VuZEZvcm0oKSB7XG5cdFx0Z2VuZXJhbFNldHRpbmdzTW9kaWZ5LmNoZWNrRGVsZXRlQWxsQ29uZGl0aW9ucygpO1xuXG5cdH0sXG5cdGluaXRpYWxpemVGb3JtKCkge1xuXHRcdEZvcm0uJGZvcm1PYmogPSBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJGZvcm1PYmo7XG5cdFx0Rm9ybS51cmwgPSBgJHtnbG9iYWxSb290VXJsfWdlbmVyYWwtc2V0dGluZ3Mvc2F2ZWA7XG5cdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0gZ2VuZXJhbFNldHRpbmdzTW9kaWZ5LnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gZ2VuZXJhbFNldHRpbmdzTW9kaWZ5LmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuY2JBZnRlclNlbmRGb3JtO1xuXHRcdEZvcm0uaW5pdGlhbGl6ZSgpO1xuXHR9LFxufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRnZW5lcmFsU2V0dGluZ3NNb2RpZnkuaW5pdGlhbGl6ZSgpO1xufSk7Il19