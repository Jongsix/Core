"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl,globalTranslate, Form, PasswordScore, PbxApi, UserMessage */
var generalSettingsModify = {
  $dirrtyField: $('#dirrty'),
  $formObj: $('#general-settings-form'),
  $webAdminPassword: $('#WebAdminPassword'),
  $sshPassword: $('#SSHPassword'),
  validateRules: {
    pbxname: {
      identifier: 'PBXName',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.gs_ValidateEmptyPBXName
      }]
    },
    WebAdminPassword: {
      identifier: 'WebAdminPassword',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.gs_ValidateEmptyWebPassword
      }, {
        type: 'minLength[5]',
        prompt: globalTranslate.gs_ValidateWeakWebPassword
      }]
    },
    WebAdminPasswordRepeat: {
      identifier: 'WebAdminPasswordRepeat',
      rules: [{
        type: 'match[WebAdminPassword]',
        prompt: globalTranslate.gs_ValidateWebPasswordsFieldDifferent
      }]
    },
    SSHPassword: {
      identifier: 'SSHPassword',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.gs_ValidateEmptySSHPassword
      }, {
        type: 'minLength[5]',
        prompt: globalTranslate.gs_ValidateWeakSSHPassword
      }]
    },
    SSHPasswordRepeat: {
      identifier: 'SSHPasswordRepeat',
      rules: [{
        type: 'match[SSHPassword]',
        prompt: globalTranslate.gs_ValidateSSHPasswordsFieldDifferent
      }]
    },
    WEBPort: {
      identifier: 'WEBPort',
      rules: [{
        type: 'integer[1..65535]',
        prompt: globalTranslate.gs_ValidateWEBPortOutOfRange
      }]
    },
    WEBHTTPSPort: {
      identifier: 'WEBHTTPSPort',
      rules: [{
        type: 'integer[1..65535]',
        prompt: globalTranslate.gs_ValidateWEBHTTPSPortOutOfRange
      }, {
        type: 'different[WEBPort]',
        prompt: globalTranslate.gs_ValidateWEBHTTPSPortNotEqualToWEBPort
      }]
    }
  },
  initialize: function () {
    function initialize() {
      generalSettingsModify.$webAdminPassword.on('keyup', function () {
        PasswordScore.checkPassStrength({
          pass: generalSettingsModify.$webAdminPassword.val(),
          bar: $('.password-score'),
          section: $('.password-score-section')
        });
      });
      generalSettingsModify.$sshPassword.on('keyup', function () {
        PasswordScore.checkPassStrength({
          pass: generalSettingsModify.$sshPassword.val(),
          bar: $('.ssh-password-score'),
          section: $('.ssh-password-score-section')
        });
      });
      $('#general-settings-menu').find('.item').tab({
        history: true,
        historyType: 'hash'
      });
      $('#general-settings-form .checkbox').checkbox();
      $('#general-settings-form .dropdown').dropdown();
      $('#audio-codecs-table, #video-codecs-table').tableDnD({
        onDrop: function () {
          function onDrop() {
            generalSettingsModify.$dirrtyField.val(Math.random());
            generalSettingsModify.$dirrtyField.trigger('change');
          }

          return onDrop;
        }(),
        onDragClass: 'hoveringRow',
        dragHandle: '.dragHandle'
      });
      generalSettingsModify.initializeForm();
    }

    return initialize;
  }(),
  checkDeleteAllConditions: function () {
    function checkDeleteAllConditions() {
      var deleteAllInput = generalSettingsModify.$formObj.form('get value', 'deleteAllInput');

      if (deleteAllInput === globalTranslate.gs_EnterDeleteAllPhrase) {
        PbxApi.SystemRestoreDefaultSettings(generalSettingsModify.cbAfterRestoreDefaultSettings);
      }
    }

    return checkDeleteAllConditions;
  }(),
  cbAfterRestoreDefaultSettings: function () {
    function cbAfterRestoreDefaultSettings(response) {
      if (response === true) {
        UserMessage.showInformation(globalTranslate.gs_AllSettingsDeleted);
      } else {
        UserMessage.showError(response);
      }
    }

    return cbAfterRestoreDefaultSettings;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = generalSettingsModify.$formObj.form('get values');
      var arrCodecs = [];
      $('#audio-codecs-table .codec-row, #video-codecs-table .codec-row').each(function (index, obj) {
        if ($(obj).attr('id')) {
          arrCodecs.push({
            codecId: $(obj).attr('id'),
            disabled: $(obj).find('.checkbox').checkbox('is unchecked'),
            priority: index
          });
        }
      });
      result.data.codecs = JSON.stringify(arrCodecs);
      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {
      generalSettingsModify.checkDeleteAllConditions();
    }

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = generalSettingsModify.$formObj;
      Form.url = "".concat(globalRootUrl, "general-settings/save");
      Form.validateRules = generalSettingsModify.validateRules;
      Form.cbBeforeSendForm = generalSettingsModify.cbBeforeSendForm;
      Form.cbAfterSendForm = generalSettingsModify.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  generalSettingsModify.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9HZW5lcmFsU2V0dGluZ3MvZ2VuZXJhbC1zZXR0aW5ncy1tb2RpZnkuanMiXSwibmFtZXMiOlsiZ2VuZXJhbFNldHRpbmdzTW9kaWZ5IiwiJGRpcnJ0eUZpZWxkIiwiJCIsIiRmb3JtT2JqIiwiJHdlYkFkbWluUGFzc3dvcmQiLCIkc3NoUGFzc3dvcmQiLCJ2YWxpZGF0ZVJ1bGVzIiwicGJ4bmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJnc19WYWxpZGF0ZUVtcHR5UEJYTmFtZSIsIldlYkFkbWluUGFzc3dvcmQiLCJnc19WYWxpZGF0ZUVtcHR5V2ViUGFzc3dvcmQiLCJnc19WYWxpZGF0ZVdlYWtXZWJQYXNzd29yZCIsIldlYkFkbWluUGFzc3dvcmRSZXBlYXQiLCJnc19WYWxpZGF0ZVdlYlBhc3N3b3Jkc0ZpZWxkRGlmZmVyZW50IiwiU1NIUGFzc3dvcmQiLCJnc19WYWxpZGF0ZUVtcHR5U1NIUGFzc3dvcmQiLCJnc19WYWxpZGF0ZVdlYWtTU0hQYXNzd29yZCIsIlNTSFBhc3N3b3JkUmVwZWF0IiwiZ3NfVmFsaWRhdGVTU0hQYXNzd29yZHNGaWVsZERpZmZlcmVudCIsIldFQlBvcnQiLCJnc19WYWxpZGF0ZVdFQlBvcnRPdXRPZlJhbmdlIiwiV0VCSFRUUFNQb3J0IiwiZ3NfVmFsaWRhdGVXRUJIVFRQU1BvcnRPdXRPZlJhbmdlIiwiZ3NfVmFsaWRhdGVXRUJIVFRQU1BvcnROb3RFcXVhbFRvV0VCUG9ydCIsImluaXRpYWxpemUiLCJvbiIsIlBhc3N3b3JkU2NvcmUiLCJjaGVja1Bhc3NTdHJlbmd0aCIsInBhc3MiLCJ2YWwiLCJiYXIiLCJzZWN0aW9uIiwiZmluZCIsInRhYiIsImhpc3RvcnkiLCJoaXN0b3J5VHlwZSIsImNoZWNrYm94IiwiZHJvcGRvd24iLCJ0YWJsZURuRCIsIm9uRHJvcCIsIk1hdGgiLCJyYW5kb20iLCJ0cmlnZ2VyIiwib25EcmFnQ2xhc3MiLCJkcmFnSGFuZGxlIiwiaW5pdGlhbGl6ZUZvcm0iLCJjaGVja0RlbGV0ZUFsbENvbmRpdGlvbnMiLCJkZWxldGVBbGxJbnB1dCIsImZvcm0iLCJnc19FbnRlckRlbGV0ZUFsbFBocmFzZSIsIlBieEFwaSIsIlN5c3RlbVJlc3RvcmVEZWZhdWx0U2V0dGluZ3MiLCJjYkFmdGVyUmVzdG9yZURlZmF1bHRTZXR0aW5ncyIsInJlc3BvbnNlIiwiVXNlck1lc3NhZ2UiLCJzaG93SW5mb3JtYXRpb24iLCJnc19BbGxTZXR0aW5nc0RlbGV0ZWQiLCJzaG93RXJyb3IiLCJjYkJlZm9yZVNlbmRGb3JtIiwic2V0dGluZ3MiLCJyZXN1bHQiLCJkYXRhIiwiYXJyQ29kZWNzIiwiZWFjaCIsImluZGV4Iiwib2JqIiwiYXR0ciIsInB1c2giLCJjb2RlY0lkIiwiZGlzYWJsZWQiLCJwcmlvcml0eSIsImNvZGVjcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjYkFmdGVyU2VuZEZvcm0iLCJGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7O0FBU0E7QUFFQSxJQUFNQSxxQkFBcUIsR0FBRztBQUM3QkMsRUFBQUEsWUFBWSxFQUFFQyxDQUFDLENBQUMsU0FBRCxDQURjO0FBRTdCQyxFQUFBQSxRQUFRLEVBQUVELENBQUMsQ0FBQyx3QkFBRCxDQUZrQjtBQUc3QkUsRUFBQUEsaUJBQWlCLEVBQUVGLENBQUMsQ0FBQyxtQkFBRCxDQUhTO0FBSTdCRyxFQUFBQSxZQUFZLEVBQUVILENBQUMsQ0FBQyxjQUFELENBSmM7QUFLN0JJLEVBQUFBLGFBQWEsRUFBRTtBQUNkQyxJQUFBQSxPQUFPLEVBQUU7QUFDUkMsTUFBQUEsVUFBVSxFQUFFLFNBREo7QUFFUkMsTUFBQUEsS0FBSyxFQUFFLENBQ047QUFDQ0MsUUFBQUEsSUFBSSxFQUFFLE9BRFA7QUFFQ0MsUUFBQUEsTUFBTSxFQUFFQyxlQUFlLENBQUNDO0FBRnpCLE9BRE07QUFGQyxLQURLO0FBVWRDLElB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akIvRSxNQUFBQSxxQkFBcUIsQ0FBQ21ELHdCQUF0QjtBQUVBOztBQXBKNEI7QUFBQTtBQXFKN0JELEVBQUFBLGNBcko2QjtBQUFBLDhCQXFKWjtBQUNoQjhCLE1BQUFBLElBQUksQ0FBQzdFLFFBQUwsR0FBZ0JILHFCQUFxQixDQUFDRyxRQUF0QztBQUNBNkUsTUFBQUEsSUFBSSxDQUFDQyxHQUFMLGFBQWNDLGFBQWQ7QUFDQUYsTUFBQUEsSUFBSSxDQUFDMUUsYUFBTCxHQUFxQk4scUJBQXFCLENBQUNNLGFBQTNDO0FBQ0EwRSxNQUFBQSxJQUFJLENBQUNqQixnQkFBTCxHQUF3Qi9ELHFCQUFxQixDQUFDK0QsZ0JBQTlDO0FBQ0FpQixNQUFBQSxJQUFJLENBQUNELGVBQUwsR0FBdUIvRSxxQkFBcUIsQ0FBQytFLGVBQTdDO0FBQ0FDLE1BQUFBLElBQUksQ0FBQ25ELFVBQUw7QUFDQTs7QUE1SjRCO0FBQUE7QUFBQSxDQUE5QjtBQStKQTNCLENBQUMsQ0FBQ2lGLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkJwRixFQUFBQSxxQkFBcUIsQ0FBQzZCLFVBQXRCO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKEMpIE1JS08gTExDIC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxuICogVW5hdXRob3JpemVkIGNvcHlpbmcgb2YgdGhpcyBmaWxlLCB2aWEgYW55IG1lZGl1bSBpcyBzdHJpY3RseSBwcm9oaWJpdGVkXG4gKiBQcm9wcmlldGFyeSBhbmQgY29uZmlkZW50aWFsXG4gKiBXcml0dGVuIGJ5IE5pa29sYXkgQmVrZXRvdiwgMTIgMjAxOVxuICpcbiAqL1xuXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLGdsb2JhbFRyYW5zbGF0ZSwgRm9ybSwgUGFzc3dvcmRTY29yZSwgUGJ4QXBpLCBVc2VyTWVzc2FnZSAqL1xuXG5jb25zdCBnZW5lcmFsU2V0dGluZ3NNb2RpZnkgPSB7XG5cdCRkaXJydHlGaWVsZDogJCgnI2RpcnJ0eScpLFxuXHQkZm9ybU9iajogJCgnI2dlbmVyYWwtc2V0dGluZ3MtZm9ybScpLFxuXHQkd2ViQWRtaW5QYXNzd29yZDogJCgnI1dlYkFkbWluUGFzc3dvcmQnKSxcblx0JHNzaFBhc3N3b3JkOiAkKCcjU1NIUGFzc3dvcmQnKSxcblx0dmFsaWRhdGVSdWxlczoge1xuXHRcdHBieG5hbWU6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdQQlhOYW1lJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlRW1wdHlQQlhOYW1lLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdFdlYkFkbWluUGFzc3dvcmQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdXZWJBZG1pblBhc3N3b3JkJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlRW1wdHlXZWJQYXNzd29yZCxcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdtaW5MZW5ndGhbNV0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlV2Vha1dlYlBhc3N3b3JkLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdFdlYkFkbWluUGFzc3dvcmRSZXBlYXQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdXZWJBZG1pblBhc3N3b3JkUmVwZWF0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnbWF0Y2hbV2ViQWRtaW5QYXNzd29yZF0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlV2ViUGFzc3dvcmRzRmllbGREaWZmZXJlbnQsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0U1NIUGFzc3dvcmQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdTU0hQYXNzd29yZCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5nc19WYWxpZGF0ZUVtcHR5U1NIUGFzc3dvcmQsXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnbWluTGVuZ3RoWzVdJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5nc19WYWxpZGF0ZVdlYWtTU0hQYXNzd29yZCxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRTU0hQYXNzd29yZFJlcGVhdDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ1NTSFBhc3N3b3JkUmVwZWF0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnbWF0Y2hbU1NIUGFzc3dvcmRdJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5nc19WYWxpZGF0ZVNTSFBhc3N3b3Jkc0ZpZWxkRGlmZmVyZW50LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdFdFQlBvcnQ6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdXRUJQb3J0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnaW50ZWdlclsxLi42NTUzNV0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlV0VCUG9ydE91dE9mUmFuZ2UsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0V0VCSFRUUFNQb3J0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnV0VCSFRUUFNQb3J0Jyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnaW50ZWdlclsxLi42NTUzNV0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlV0VCSFRUUFNQb3J0T3V0T2ZSYW5nZSxcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdkaWZmZXJlbnRbV0VCUG9ydF0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmdzX1ZhbGlkYXRlV0VCSFRUUFNQb3J0Tm90RXF1YWxUb1dFQlBvcnQsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0Z2VuZXJhbFNldHRpbmdzTW9kaWZ5LiR3ZWJBZG1pblBhc3N3b3JkLm9uKCdrZXl1cCcsICgpID0+IHtcblx0XHRcdFBhc3N3b3JkU2NvcmUuY2hlY2tQYXNzU3RyZW5ndGgoe1xuXHRcdFx0XHRwYXNzOiBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJHdlYkFkbWluUGFzc3dvcmQudmFsKCksXG5cdFx0XHRcdGJhcjogJCgnLnBhc3N3b3JkLXNjb3JlJyksXG5cdFx0XHRcdHNlY3Rpb246ICQoJy5wYXNzd29yZC1zY29yZS1zZWN0aW9uJyksXG5cdFx0XHR9KTtcblx0XHR9KTtcblx0XHRnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJHNzaFBhc3N3b3JkLm9uKCdrZXl1cCcsICgpID0+IHtcblx0XHRcdFBhc3N3b3JkU2NvcmUuY2hlY2tQYXNzU3RyZW5ndGgoe1xuXHRcdFx0XHRwYXNzOiBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJHNzaFBhc3N3b3JkLnZhbCgpLFxuXHRcdFx0XHRiYXI6ICQoJy5zc2gtcGFzc3dvcmQtc2NvcmUnKSxcblx0XHRcdFx0c2VjdGlvbjogJCgnLnNzaC1wYXNzd29yZC1zY29yZS1zZWN0aW9uJyksXG5cdFx0XHR9KTtcblx0XHR9KTtcblx0XHQkKCcjZ2VuZXJhbC1zZXR0aW5ncy1tZW51JykuZmluZCgnLml0ZW0nKS50YWIoe1xuXHRcdFx0aGlzdG9yeTogdHJ1ZSxcblx0XHRcdGhpc3RvcnlUeXBlOiAnaGFzaCcsXG5cdFx0fSk7XG5cdFx0JCgnI2dlbmVyYWwtc2V0dGluZ3MtZm9ybSAuY2hlY2tib3gnKS5jaGVja2JveCgpO1xuXHRcdCQoJyNnZW5lcmFsLXNldHRpbmdzLWZvcm0gLmRyb3Bkb3duJykuZHJvcGRvd24oKTtcblxuXHRcdCQoJyNhdWRpby1jb2RlY3MtdGFibGUsICN2aWRlby1jb2RlY3MtdGFibGUnKS50YWJsZURuRCh7XG5cdFx0XHRvbkRyb3AoKSB7XG5cdFx0XHRcdGdlbmVyYWxTZXR0aW5nc01vZGlmeS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0fSxcblx0XHRcdG9uRHJhZ0NsYXNzOiAnaG92ZXJpbmdSb3cnLFxuXHRcdFx0ZHJhZ0hhbmRsZTogJy5kcmFnSGFuZGxlJyxcblx0XHR9KTtcblx0XHRnZW5lcmFsU2V0dGluZ3NNb2RpZnkuaW5pdGlhbGl6ZUZvcm0oKTtcblx0fSxcblx0Y2hlY2tEZWxldGVBbGxDb25kaXRpb25zKCl7XG5cdFx0Y29uc3QgZGVsZXRlQWxsSW5wdXQgPSBnZW5lcmFsU2V0dGluZ3NNb2RpZnkuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2RlbGV0ZUFsbElucHV0Jyk7XG5cdFx0aWYgKGRlbGV0ZUFsbElucHV0ID09PSBnbG9iYWxUcmFuc2xhdGUuZ3NfRW50ZXJEZWxldGVBbGxQaHJhc2Upe1xuXHRcdFx0UGJ4QXBpLlN5c3RlbVJlc3RvcmVEZWZhdWx0U2V0dGluZ3MoZ2VuZXJhbFNldHRpbmdzTW9kaWZ5LmNiQWZ0ZXJSZXN0b3JlRGVmYXVsdFNldHRpbmdzKTtcblx0XHR9XG5cblx0fSxcblx0Y2JBZnRlclJlc3RvcmVEZWZhdWx0U2V0dGluZ3MocmVzcG9uc2Upe1xuXHRcdGlmIChyZXNwb25zZT09PXRydWUpe1xuXHRcdFx0VXNlck1lc3NhZ2Uuc2hvd0luZm9ybWF0aW9uKGdsb2JhbFRyYW5zbGF0ZS5nc19BbGxTZXR0aW5nc0RlbGV0ZWQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRVc2VyTWVzc2FnZS5zaG93RXJyb3IocmVzcG9uc2UpO1xuXHRcdH1cblx0fSxcblx0Y2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuXHRcdGNvbnN0IHJlc3VsdCA9IHNldHRpbmdzO1xuXHRcdHJlc3VsdC5kYXRhID0gZ2VuZXJhbFNldHRpbmdzTW9kaWZ5LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0XHRjb25zdCBhcnJDb2RlY3MgPSBbXTtcblx0XHQkKCcjYXVkaW8tY29kZWNzLXRhYmxlIC5jb2RlYy1yb3csICN2aWRlby1jb2RlY3MtdGFibGUgLmNvZGVjLXJvdycpLmVhY2goKGluZGV4LCBvYmopID0+IHtcblx0XHRcdGlmICgkKG9iaikuYXR0cignaWQnKSkge1xuXHRcdFx0XHRhcnJDb2RlY3MucHVzaCh7XG5cdFx0XHRcdFx0Y29kZWNJZDogJChvYmopLmF0dHIoJ2lkJyksXG5cdFx0XHRcdFx0ZGlzYWJsZWQ6ICQob2JqKS5maW5kKCcuY2hlY2tib3gnKS5jaGVja2JveCgnaXMgdW5jaGVja2VkJyksXG5cdFx0XHRcdFx0cHJpb3JpdHk6IGluZGV4LFxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRyZXN1bHQuZGF0YS5jb2RlY3MgPSBKU09OLnN0cmluZ2lmeShhcnJDb2RlY3MpO1xuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblx0Y2JBZnRlclNlbmRGb3JtKCkge1xuXHRcdGdlbmVyYWxTZXR0aW5nc01vZGlmeS5jaGVja0RlbGV0ZUFsbENvbmRpdGlvbnMoKTtcblxuXHR9LFxuXHRpbml0aWFsaXplRm9ybSgpIHtcblx0XHRGb3JtLiRmb3JtT2JqID0gZ2VuZXJhbFNldHRpbmdzTW9kaWZ5LiRmb3JtT2JqO1xuXHRcdEZvcm0udXJsID0gYCR7Z2xvYmFsUm9vdFVybH1nZW5lcmFsLXNldHRpbmdzL3NhdmVgO1xuXHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IGdlbmVyYWxTZXR0aW5nc01vZGlmeS52YWxpZGF0ZVJ1bGVzO1xuXHRcdEZvcm0uY2JCZWZvcmVTZW5kRm9ybSA9IGdlbmVyYWxTZXR0aW5nc01vZGlmeS5jYkJlZm9yZVNlbmRGb3JtO1xuXHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtID0gZ2VuZXJhbFNldHRpbmdzTW9kaWZ5LmNiQWZ0ZXJTZW5kRm9ybTtcblx0XHRGb3JtLmluaXRpYWxpemUoKTtcblx0fSxcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0Z2VuZXJhbFNldHRpbmdzTW9kaWZ5LmluaXRpYWxpemUoKTtcbn0pOyJdfQ==