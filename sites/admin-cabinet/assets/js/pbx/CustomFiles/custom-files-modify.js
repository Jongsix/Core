"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl,globalTranslate, ace, Form, PbxApi */
var customFile = {
  $formObj: $('#custom-file-form'),
  $typeSelectDropDown: $('#custom-file-form .type-select'),
  $appCode: $('#application-code'),
  $appCodeFromServer: $('#application-code-readonly'),
  editor: '',
  viewer: '',
  validateRules: {
    name: {
      identifier: 'filepath',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cf_ValidateNameIsEmpty
      }]
    }
  },
  initialize: function () {
    function initialize() {
      customFile.$typeSelectDropDown.dropdown({
        onChange: function () {
          function onChange() {
            customFile.hideShowCode();
            customFile.getFileContentFromServer();
          }

          return onChange;
        }()
      });
      customFile.initializeAce();
      customFile.initializeForm();
      customFile.getFileContentFromServer();
    }

    return initialize;
  }(),
  hideShowCode: function () {
    function hideShowCode() {
      var aceHeight = window.innerHeight - 500;
      var rowsCount = Math.round(aceHeight / 16.3);
      $(window).load(function () {
        $('.application-code-readonly').css('min-height', "".concat(aceHeight, "px"));
        $('.application-code').css('min-height', "".concat(aceHeight, "px"));
      });
      var mode = customFile.$formObj.form('get value', 'mode');

      switch (mode) {
        case 'none':
          customFile.viewer.navigateFileStart();
          customFile.$appCodeFromServer.show();
          customFile.$appCode.hide();
          customFile.viewer.setOptions({
            maxLines: rowsCount
          });
          customFile.viewer.resize();
          break;

        case 'append':
          customFile.$appCodeFromServer.show();
          customFile.viewer.navigateFileEnd();
          customFile.editor.setValue(customFile.$formObj.form('get value', 'content'));
          customFile.$appCode.show();
          break;

        case 'override':
          customFile.editor.navigateFileStart();
          customFile.$appCodeFromServer.hide();
          customFile.editor.setValue(customFile.$formObj.form('get value', 'content'));
          customFile.$appCode.show();
          customFile.editor.setOptions({
            maxLines: rowsCount
          });
          customFile.editor.resize();
          break;

        default:
          break;
      }
    }

    return hideShowCode;
  }(),
  cbGetFileContentFromServer: function () {
    function cbGetFileContentFromServer(response) {
      if (response !== undefined) {
        var fileContent = decodeURIComponent(response.data['content']);
        customFile.viewer.setValue(fileContent);
        customFile.hideShowCode();
      }
    }

    return cbGetFileContentFromServer;
  }(),
  getFileContentFromServer: function () {
    function getFileContentFromServer() {
      var filePath = customFile.$formObj.form('get value', 'filepath');
      var mode = customFile.$formObj.form('get value', 'mode') !== 'override';
      var data = {
        filename: filePath,
        needOriginal: mode,
        needLogfile: false
      };
      PbxApi.GetFileContent(data, customFile.cbGetFileContentFromServer);
    }

    return getFileContentFromServer;
  }(),
  initializeAce: function () {
    function initializeAce() {
      var IniMode = ace.require('ace/mode/julia').Mode;

      customFile.viewer = ace.edit('application-code-readonly');
      customFile.viewer.session.setMode(new IniMode());
      customFile.viewer.setTheme('ace/theme/monokai');
      customFile.viewer.setOptions({
        showPrintMargin: false,
        readOnly: true
      });
      customFile.viewer.resize();
      customFile.editor = ace.edit('application-code');
      customFile.editor.setTheme('ace/theme/monokai');
      customFile.editor.session.setMode(new IniMode());
      customFile.editor.setOptions({
        showPrintMargin: false
      });
      customFile.editor.resize();
    }

    return initializeAce;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = customFile.$formObj.form('get values');

      switch (customFile.$formObj.form('get value', 'mode')) {
        case 'append':
        case 'override':
          result.data.content = customFile.editor.getValue();
          break;

        default:
          result.data.content = '';
      }

      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {}

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = customFile.$formObj;
      Form.url = "".concat(globalRootUrl, "custom-files/save");
      Form.validateRules = customFile.validateRules;
      Form.cbBeforeSendForm = customFile.cbBeforeSendForm;
      Form.cbAfterSendForm = customFile.cbAfterSendForm;
      Form.enableDirrity = false;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  customFile.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DdXN0b21GaWxlcy9jdXN0b20tZmlsZXMtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbImN1c3RvbUZpbGUiLCIkZm9ybU9iaiIsIiQiLCIkdHlwZVNlbGVjdERyb3BEb3duIiwiJGFwcENvZGUiLCIkYXBwQ29kZUZyb21TZXJ2ZXIiLCJlZGl0b3IiLCJ2aWV3ZXIiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJjZl9WYWxpZGF0ZU5hbWVJc0VtcHR5IiwiaW5pdGlhbGl6ZSIsImRyb3Bkb3duIiwib25DaGFuZ2UiLCJoaWRlU2hvd0NvZGUiLCJnZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIiLCJpbml0aWFsaXplQWNlIiwiaW5pdGlhbGl6ZUZvcm0iLCJhY2VIZWlnaHQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsInJvd3NDb3VudCIsIk1hdGgiLCJyb3VuZCIsImxvYWQiLCJjc3MiLCJtb2RlIiwiZm9ybSIsIm5hdmlnYXRlRmlsZVN0YXJ0Iiwic2hvdyIsImhpZGUiLCJzZXRPcHRpb25zIiwibWF4TGluZXMiLCJyZXNpemUiLCJuYXZpZ2F0ZUZpbGVFbmQiLCJzZXRWYWx1ZSIsImNiR2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyIiwicmVzcG9uc2UiLCJ1bmRlZmluZWQiLCJmaWxlQ29udGVudCIsImRlY29kZVVSSUNvbXBvbmVudCIsImRhdGEiLCJmaWxlUGF0aCIsImZpbGVuYW1lIiwibmVlZE9yaWdpbmFsIiwibmVlZExvZ2ZpbGUiLCJQYnhBcGkiLCJHZXRGaWxlQ29udGVudCIsIkluaU1vZGUiLCJhY2UiLCJyZXF1aXJlIiwiTW9kZSIsImVkaXQiLCJzZXNzaW9uIiwic2V0TW9kZSIsInNldFRoZW1lIiwic2hvd1ByaW50TWFyZ2luIiwicmVhZE9ubHkiLCJjYkJlZm9yZVNlbmRGb3JtIiwic2V0dGluZ3MiLCJyZXN1bHQiLCJjb250ZW50IiwiZ2V0VmFsdWUiLCJjYkFmdGVyU2VuZEZvcm0iLCJGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImVuYWJsZURpcnJpdHkiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7OztBQVFBO0FBRUEsSUFBTUEsVUFBVSxHQUFHO0FBQ2xCQyxFQUFBQSxRQUFRLEVBQUVDLENBQUMsQ0FBQyxtQkFBRCxDQURPO0FBRWxCQyxFQUFBQSxtQkFBbUIsRUFBRUQsQ0FBQyxDQUFDLGdDQUFELENBRko7QUFHbEJFLEVBQUFBLFFBQVEsRUFBRUYsQ0FBQyxDQUFDLG1CQUFELENBSE87QUFJbEJHLEVBQUFBLGtCQUFrQixFQUFFSCxDQUFDLENBQUMsNEJBQUQsQ0FKSDtBQUtsQkksRUFBQUEsTUFBTSxFQUFFLEVBTFU7QUFNbEJDLEVBQUFBLE1BQU0sRUFBRSxFQU5VO0FBT2xCQyxFQUFBQSxhQUFhLEVBQUU7QUFDZEMsSUFBQUEsSUFBSSxFQUFFO0FBQ0xDLE1BQUFBLFVBQVUsRUFBRSxVQURQO0FBRUxDLE1BQUFBLEtBQUssRUFBRSxDQUNOO0FBQ0NDLFFBQUFBLElBQUksRUFBRSxPQURQO0FBRUNDLFFBQUFBLE1BQU0sRUFBRUMsZUFBZSxDQUFDQztBQUZ6QixPQURNO0FBRkY7QUFEUSxHQVBHO0FBa0JsQkMsRUFBQUEsVUFsQmtCO0FBQUEsMEJBa0JMO0FBQ1poQixNQUFBQSxVQUFVLENBQUNHLG1CQUFYLENBQStCYyxRQUEvQixDQUF3QztBQUN2Q0MsUUFBQUEsUUFEdUM7QUFBQSw4QkFDNUI7QUFDVmxCLFlBQUFBLFVBQVUsQ0FBQ21CLFlBQVg7QUFDQW5CLFlBQUFBLFVBQVUsQ0FBQ29CLHdCQUFYO0FBQ0E7O0FBSnNDO0FBQUE7QUFBQSxPQUF4QztBQU9BcEIsTUFBQUEsVUFBVSxDQUFDcUIsYUFBWDtBQUNBckIsTUFBQUEsVUFBVSxDQUFDc0IsY0FBWDtBQUNBdEIsTUFBQUEsVUFBVSxDQUFDb0Isd0JBQVg7QUFDQTs7QUE3QmlCO0FBQUE7QUE4QmxCRCxFQUFBQSxZQTlC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Q04sZ0JBQUwsR0FBd0IvRCxVQUFVLENBQUMrRCxnQkFBbkM7QUFDQU0sTUFBQUEsSUFBSSxDQUFDRCxlQUFMLEdBQXVCcEUsVUFBVSxDQUFDb0UsZUFBbEM7QUFDQUMsTUFBQUEsSUFBSSxDQUFDRyxhQUFMLEdBQXFCLEtBQXJCO0FBQ0FILE1BQUFBLElBQUksQ0FBQ3JELFVBQUw7QUFDQTs7QUE1SGlCO0FBQUE7QUFBQSxDQUFuQjtBQStIQWQsQ0FBQyxDQUFDdUUsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUN2QjFFLEVBQUFBLFVBQVUsQ0FBQ2dCLFVBQVg7QUFDQSxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoQykgTUlLTyBMTEMgLSBBbGwgUmlnaHRzIFJlc2VydmVkXG4gKiBVbmF1dGhvcml6ZWQgY29weWluZyBvZiB0aGlzIGZpbGUsIHZpYSBhbnkgbWVkaXVtIGlzIHN0cmljdGx5IHByb2hpYml0ZWRcbiAqIFByb3ByaWV0YXJ5IGFuZCBjb25maWRlbnRpYWxcbiAqIFdyaXR0ZW4gYnkgTmlrb2xheSBCZWtldG92LCAxMiAyMDE5XG4gKlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLGdsb2JhbFRyYW5zbGF0ZSwgYWNlLCBGb3JtLCBQYnhBcGkgKi9cblxuY29uc3QgY3VzdG9tRmlsZSA9IHtcblx0JGZvcm1PYmo6ICQoJyNjdXN0b20tZmlsZS1mb3JtJyksXG5cdCR0eXBlU2VsZWN0RHJvcERvd246ICQoJyNjdXN0b20tZmlsZS1mb3JtIC50eXBlLXNlbGVjdCcpLFxuXHQkYXBwQ29kZTogJCgnI2FwcGxpY2F0aW9uLWNvZGUnKSxcblx0JGFwcENvZGVGcm9tU2VydmVyOiAkKCcjYXBwbGljYXRpb24tY29kZS1yZWFkb25seScpLFxuXHRlZGl0b3I6ICcnLFxuXHR2aWV3ZXI6ICcnLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0bmFtZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ2ZpbGVwYXRoJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmNmX1ZhbGlkYXRlTmFtZUlzRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0Y3VzdG9tRmlsZS4kdHlwZVNlbGVjdERyb3BEb3duLmRyb3Bkb3duKHtcblx0XHRcdG9uQ2hhbmdlKCkge1xuXHRcdFx0XHRjdXN0b21GaWxlLmhpZGVTaG93Q29kZSgpO1xuXHRcdFx0XHRjdXN0b21GaWxlLmdldEZpbGVDb250ZW50RnJvbVNlcnZlcigpO1xuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdGN1c3RvbUZpbGUuaW5pdGlhbGl6ZUFjZSgpO1xuXHRcdGN1c3RvbUZpbGUuaW5pdGlhbGl6ZUZvcm0oKTtcblx0XHRjdXN0b21GaWxlLmdldEZpbGVDb250ZW50RnJvbVNlcnZlcigpO1xuXHR9LFxuXHRoaWRlU2hvd0NvZGUoKSB7XG5cdFx0Y29uc3QgYWNlSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0LTUwMDtcblx0XHRjb25zdCByb3dzQ291bnQgPSBNYXRoLnJvdW5kKGFjZUhlaWdodC8xNi4zKTtcblx0XHQkKHdpbmRvdykubG9hZChmdW5jdGlvbigpIHtcblx0XHRcdCQoJy5hcHBsaWNhdGlvbi1jb2RlLXJlYWRvbmx5JykuY3NzKCdtaW4taGVpZ2h0JywgYCR7YWNlSGVpZ2h0fXB4YCk7XG5cdFx0XHQkKCcuYXBwbGljYXRpb24tY29kZScpLmNzcygnbWluLWhlaWdodCcsIGAke2FjZUhlaWdodH1weGApO1xuXHRcdH0pO1xuXHRcdGNvbnN0IG1vZGUgPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdtb2RlJyk7XG5cdFx0c3dpdGNoIChtb2RlKSB7XG5cdFx0XHRjYXNlICdub25lJzpcblx0XHRcdFx0Y3VzdG9tRmlsZS52aWV3ZXIubmF2aWdhdGVGaWxlU3RhcnQoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZUZyb21TZXJ2ZXIuc2hvdygpO1xuXHRcdFx0XHRjdXN0b21GaWxlLiRhcHBDb2RlLmhpZGUoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS52aWV3ZXIuc2V0T3B0aW9ucyh7XG5cdFx0XHRcdFx0bWF4TGluZXM6IHJvd3NDb3VudCxcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGN1c3RvbUZpbGUudmlld2VyLnJlc2l6ZSgpXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnYXBwZW5kJzpcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZUZyb21TZXJ2ZXIuc2hvdygpO1xuXHRcdFx0XHRjdXN0b21GaWxlLnZpZXdlci5uYXZpZ2F0ZUZpbGVFbmQoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3Iuc2V0VmFsdWUoY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnY29udGVudCcpKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZS5zaG93KCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnb3ZlcnJpZGUnOlxuXHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5uYXZpZ2F0ZUZpbGVTdGFydCgpO1xuXHRcdFx0XHRjdXN0b21GaWxlLiRhcHBDb2RlRnJvbVNlcnZlci5oaWRlKCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLnNldFZhbHVlKGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2NvbnRlbnQnKSk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGUuc2hvdygpO1xuXHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXRPcHRpb25zKHtcblx0XHRcdFx0XHRtYXhMaW5lczogcm93c0NvdW50LFxuXHRcdFx0XHR9KTtcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3IucmVzaXplKClcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH0sXG5cdGNiR2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKHJlc3BvbnNlKSB7XG5cdFx0aWYgKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGNvbnN0IGZpbGVDb250ZW50ID0gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3BvbnNlLmRhdGFbJ2NvbnRlbnQnXSk7XG5cdFx0XHRjdXN0b21GaWxlLnZpZXdlci5zZXRWYWx1ZShmaWxlQ29udGVudCk7XG5cdFx0XHRjdXN0b21GaWxlLmhpZGVTaG93Q29kZSgpO1xuXHRcdH1cblx0fSxcblx0Z2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKCkge1xuXHRcdGNvbnN0IGZpbGVQYXRoID0gY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZmlsZXBhdGgnKTtcblx0XHRjb25zdCBtb2RlID0gY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnbW9kZScpICE9PSAnb3ZlcnJpZGUnO1xuXHRcdGNvbnN0IGRhdGEgPSB7IGZpbGVuYW1lOiBmaWxlUGF0aCwgbmVlZE9yaWdpbmFsOiBtb2RlLCBuZWVkTG9nZmlsZTogZmFsc2UgfTtcblx0XHRQYnhBcGkuR2V0RmlsZUNvbnRlbnQoZGF0YSwgY3VzdG9tRmlsZS5jYkdldEZpbGVDb250ZW50RnJvbVNlcnZlcik7XG5cdH0sXG5cdGluaXRpYWxpemVBY2UoKSB7XG5cdFx0Y29uc3QgSW5pTW9kZSA9IGFjZS5yZXF1aXJlKCdhY2UvbW9kZS9qdWxpYScpLk1vZGU7XG5cdFx0Y3VzdG9tRmlsZS52aWV3ZXIgPSBhY2UuZWRpdCgnYXBwbGljYXRpb24tY29kZS1yZWFkb25seScpO1xuXHRcdGN1c3RvbUZpbGUudmlld2VyLnNlc3Npb24uc2V0TW9kZShuZXcgSW5pTW9kZSgpKTtcblx0XHRjdXN0b21GaWxlLnZpZXdlci5zZXRUaGVtZSgnYWNlL3RoZW1lL21vbm9rYWknKTtcblx0XHRjdXN0b21GaWxlLnZpZXdlci5zZXRPcHRpb25zKHtcblx0XHRcdHNob3dQcmludE1hcmdpbjogZmFsc2UsXG5cdFx0XHRyZWFkT25seTogdHJ1ZVxuXHRcdH0pO1xuXHRcdGN1c3RvbUZpbGUudmlld2VyLnJlc2l6ZSgpO1xuXG5cdFx0Y3VzdG9tRmlsZS5lZGl0b3IgPSBhY2UuZWRpdCgnYXBwbGljYXRpb24tY29kZScpO1xuXHRcdGN1c3RvbUZpbGUuZWRpdG9yLnNldFRoZW1lKCdhY2UvdGhlbWUvbW9ub2thaScpO1xuXHRcdGN1c3RvbUZpbGUuZWRpdG9yLnNlc3Npb24uc2V0TW9kZShuZXcgSW5pTW9kZSgpKTtcblx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXRPcHRpb25zKHtcblx0XHRcdHNob3dQcmludE1hcmdpbjogZmFsc2UsXG5cdFx0fSk7XG5cdFx0Y3VzdG9tRmlsZS5lZGl0b3IucmVzaXplKCk7XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcblx0XHRyZXN1bHQuZGF0YSA9IGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdHN3aXRjaCAoY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnbW9kZScpKSB7XG5cdFx0XHRjYXNlICdhcHBlbmQnOlxuXHRcdFx0Y2FzZSAnb3ZlcnJpZGUnOlxuXHRcdFx0XHRyZXN1bHQuZGF0YS5jb250ZW50ID0gY3VzdG9tRmlsZS5lZGl0b3IuZ2V0VmFsdWUoKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRyZXN1bHQuZGF0YS5jb250ZW50ID0gJyc7XG5cdFx0fVxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdGNiQWZ0ZXJTZW5kRm9ybSgpIHtcblxuXHR9LFxuXHRpbml0aWFsaXplRm9ybSgpIHtcblx0XHRGb3JtLiRmb3JtT2JqID0gY3VzdG9tRmlsZS4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9Y3VzdG9tLWZpbGVzL3NhdmVgO1xuXHRcdEZvcm0udmFsaWRhdGVSdWxlcyA9IGN1c3RvbUZpbGUudmFsaWRhdGVSdWxlcztcblx0XHRGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBjdXN0b21GaWxlLmNiQmVmb3JlU2VuZEZvcm07XG5cdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBjdXN0b21GaWxlLmNiQWZ0ZXJTZW5kRm9ybTtcblx0XHRGb3JtLmVuYWJsZURpcnJpdHkgPSBmYWxzZTtcblx0XHRGb3JtLmluaXRpYWxpemUoKTtcblx0fSxcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0Y3VzdG9tRmlsZS5pbml0aWFsaXplKCk7XG59KTtcblxuIl19