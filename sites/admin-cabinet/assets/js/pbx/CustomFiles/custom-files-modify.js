"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl,globalTranslate, ace, Form, PbxApi */
var customFile = {
  $formObj: $('#custom-file-form'),
  $typeSelectDropDown: $('#custom-file-form .type-select'),
  $appCode: $('#application-code'),
  $appCodeFromServer: $('#application-code-readonly'),
  editor: '',
  viewer: '',
  validateRules: {
    name: {
      identifier: 'filepath',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cf_ValidateNameIsEmpty
      }]
    }
  },
  initialize: function () {
    function initialize() {
      customFile.$typeSelectDropDown.dropdown({
        onChange: function () {
          function onChange() {
            customFile.hideShowCode();
            customFile.getFileContentFromServer();
          }

          return onChange;
        }()
      });
      customFile.initializeAce();
      customFile.initializeForm();
      customFile.getFileContentFromServer();
    }

    return initialize;
  }(),
  hideShowCode: function () {
    function hideShowCode() {
      var aceHeight = window.innerHeight - 500;
      var rowsCount = Math.round(aceHeight / 16.3);
      $(window).load(function () {
        $('.application-code-readonly').css('min-height', "".concat(aceHeight, "px"));
        $('.application-code').css('min-height', "".concat(aceHeight, "px"));
      });
      var mode = customFile.$formObj.form('get value', 'mode');

      switch (mode) {
        case 'none':
          customFile.viewer.navigateFileStart();
          customFile.$appCodeFromServer.show();
          customFile.$appCode.hide();
          customFile.viewer.setOptions({
            maxLines: rowsCount
          });
          customFile.viewer.resize();
          break;

        case 'append':
          customFile.$appCodeFromServer.show();
          customFile.viewer.navigateFileEnd();
          customFile.editor.setValue(customFile.$formObj.form('get value', 'content'));
          customFile.$appCode.show();
          break;

        case 'override':
          customFile.editor.navigateFileStart();
          customFile.$appCodeFromServer.hide();
          customFile.editor.setValue(customFile.$formObj.form('get value', 'content'));
          customFile.$appCode.show();
          customFile.editor.setOptions({
            maxLines: rowsCount
          });
          customFile.editor.resize();
          break;

        default:
          break;
      }
    }

    return hideShowCode;
  }(),
  cbGetFileContentFromServer: function () {
    function cbGetFileContentFromServer(response) {
      if (response !== undefined) {
        var fileContent = decodeURIComponent(response.data.content);
        customFile.viewer.setValue(fileContent);
        customFile.hideShowCode();
      }
    }

    return cbGetFileContentFromServer;
  }(),
  getFileContentFromServer: function () {
    function getFileContentFromServer() {
      var filePath = customFile.$formObj.form('get value', 'filepath');
      var mode = customFile.$formObj.form('get value', 'mode') !== 'override';
      var data = {
        filename: filePath,
        needOriginal: mode,
        needLogfile: false
      };
      PbxApi.GetFileContent(data, customFile.cbGetFileContentFromServer);
    }

    return getFileContentFromServer;
  }(),
  initializeAce: function () {
    function initializeAce() {
      var IniMode = ace.require('ace/mode/julia').Mode;

      customFile.viewer = ace.edit('application-code-readonly');
      customFile.viewer.session.setMode(new IniMode());
      customFile.viewer.setTheme('ace/theme/monokai');
      customFile.viewer.setOptions({
        showPrintMargin: false,
        readOnly: true
      });
      customFile.viewer.resize();
      customFile.editor = ace.edit('application-code');
      customFile.editor.setTheme('ace/theme/monokai');
      customFile.editor.session.setMode(new IniMode());
      customFile.editor.setOptions({
        showPrintMargin: false
      });
      customFile.editor.resize();
    }

    return initializeAce;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = customFile.$formObj.form('get values');

      switch (customFile.$formObj.form('get value', 'mode')) {
        case 'append':
        case 'override':
          result.data.content = customFile.editor.getValue();
          break;

        default:
          result.data.content = '';
      }

      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {}

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = customFile.$formObj;
      Form.url = "".concat(globalRootUrl, "custom-files/save");
      Form.validateRules = customFile.validateRules;
      Form.cbBeforeSendForm = customFile.cbBeforeSendForm;
      Form.cbAfterSendForm = customFile.cbAfterSendForm;
      Form.enableDirrity = false;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  customFile.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DdXN0b21GaWxlcy9jdXN0b20tZmlsZXMtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbImN1c3RvbUZpbGUiLCIkZm9ybU9iaiIsIiQiLCIkdHlwZVNlbGVjdERyb3BEb3duIiwiJGFwcENvZGUiLCIkYXBwQ29kZUZyb21TZXJ2ZXIiLCJlZGl0b3IiLCJ2aWV3ZXIiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJjZl9WYWxpZGF0ZU5hbWVJc0VtcHR5IiwiaW5pdGlhbGl6ZSIsImRyb3Bkb3duIiwib25DaGFuZ2UiLCJoaWRlU2hvd0NvZGUiLCJnZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIiLCJpbml0aWFsaXplQWNlIiwiaW5pdGlhbGl6ZUZvcm0iLCJhY2VIZWlnaHQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsInJvd3NDb3VudCIsIk1hdGgiLCJyb3VuZCIsImxvYWQiLCJjc3MiLCJtb2RlIiwiZm9ybSIsIm5hdmlnYXRlRmlsZVN0YXJ0Iiwic2hvdyIsImhpZGUiLCJzZXRPcHRpb25zIiwibWF4TGluZXMiLCJyZXNpemUiLCJuYXZpZ2F0ZUZpbGVFbmQiLCJzZXRWYWx1ZSIsImNiR2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyIiwicmVzcG9uc2UiLCJ1bmRlZmluZWQiLCJmaWxlQ29udGVudCIsImRlY29kZVVSSUNvbXBvbmVudCIsImRhdGEiLCJjb250ZW50IiwiZmlsZVBhdGgiLCJmaWxlbmFtZSIsIm5lZWRPcmlnaW5hbCIsIm5lZWRMb2dmaWxlIiwiUGJ4QXBpIiwiR2V0RmlsZUNvbnRlbnQiLCJJbmlNb2RlIiwiYWNlIiwicmVxdWlyZSIsIk1vZGUiLCJlZGl0Iiwic2Vzc2lvbiIsInNldE1vZGUiLCJzZXRUaGVtZSIsInNob3dQcmludE1hcmdpbiIsInJlYWRPbmx5IiwiY2JCZWZvcmVTZW5kRm9ybSIsInNldHRpbmdzIiwicmVzdWx0IiwiZ2V0VmFsdWUiLCJjYkFmdGVyU2VuZEZvcm0iLCJGb3JtIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImVuYWJsZURpcnJpdHkiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7OztBQVFBO0FBRUEsSUFBTUEsVUFBVSxHQUFHO0FBQ2xCQyxFQUFBQSxRQUFRLEVBQUVDLENBQUMsQ0FBQyxtQkFBRCxDQURPO0FBRWxCQyxFQUFBQSxtQkFBbUIsRUFBRUQsQ0FBQyxDQUFDLGdDQUFELENBRko7QUFHbEJFLEVBQUFBLFFBQVEsRUFBRUYsQ0FBQyxDQUFDLG1CQUFELENBSE87QUFJbEJHLEVBQUFBLGtCQUFrQixFQUFFSCxDQUFDLENBQUMsNEJBQUQsQ0FKSDtBQUtsQkksRUFBQUEsTUFBTSxFQUFFLEVBTFU7QUFNbEJDLEVBQUFBLE1BQU0sRUFBRSxFQU5VO0FBT2xCQyxFQUFBQSxhQUFhLEVBQUU7QUFDZEMsSUFBQUEsSUFBSSxFQUFFO0FBQ0xDLE1BQUFBLFVBQVUsRUFBRSxVQURQO0FBRUxDLE1BQUFBLEtBQUssRUFBRSxDQUNOO0FBQ0NDLFFBQUFBLElBQUksRUFBRSxPQURQO0FBRUNDLFFBQUFBLE1BQU0sRUFBRUMsZUFBZSxDQUFDQztBQUZ6QixPQURNO0FBRkY7QUFEUSxHQVBHO0FBa0JsQkMsRUFBQUEsVUFsQmtCO0FBQUEsMEJBa0JMO0FBQ1poQixNQUFBQSxVQUFVLENBQUNHLG1CQUFYLENBQStCYyxRQUEvQixDQUF3QztBQUN2Q0MsUUFBQUEsUUFEdUM7QUFBQSw4QkFDNUI7QUFDVmxCLFlBQUFBLFVBQVUsQ0FBQ21CLFlBQVg7QUFDQW5CLFlBQUFBLFVBQVUsQ0FBQ29CLHdCQUFYO0FBQ0E7O0FBSnNDO0FBQUE7QUFBQSxPQUF4QztBQU9BcEIsTUFBQUEsVUFBVSxDQUFDcUIsYUFBWDtBQUNBckIsTUFBQUEsVUFBVSxDQUFDc0IsY0FBWDtBQUNBdEIsTUFBQUEsVUFBVSxDQUFDb0Isd0JBQVg7QUFDQTs7QUE3QmlCO0FBQUE7QUE4QmxCRCxFQUFBQSxZQTlC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QUFMLEdBQXdCaEUsVUFBVSxDQUFDZ0UsZ0JBQW5DO0FBQ0FLLE1BQUFBLElBQUksQ0FBQ0QsZUFBTCxHQUF1QnBFLFVBQVUsQ0FBQ29FLGVBQWxDO0FBQ0FDLE1BQUFBLElBQUksQ0FBQ0csYUFBTCxHQUFxQixLQUFyQjtBQUNBSCxNQUFBQSxJQUFJLENBQUNyRCxVQUFMO0FBQ0E7O0FBNUhpQjtBQUFBO0FBQUEsQ0FBbkI7QUErSEFkLENBQUMsQ0FBQ3VFLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkIxRSxFQUFBQSxVQUFVLENBQUNnQixVQUFYO0FBQ0EsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKEMpIE1JS08gTExDIC0gQWxsIFJpZ2h0cyBSZXNlcnZlZFxuICogVW5hdXRob3JpemVkIGNvcHlpbmcgb2YgdGhpcyBmaWxlLCB2aWEgYW55IG1lZGl1bSBpcyBzdHJpY3RseSBwcm9oaWJpdGVkXG4gKiBQcm9wcmlldGFyeSBhbmQgY29uZmlkZW50aWFsXG4gKiBXcml0dGVuIGJ5IE5pa29sYXkgQmVrZXRvdiwgMTIgMjAxOVxuICpcbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCxnbG9iYWxUcmFuc2xhdGUsIGFjZSwgRm9ybSwgUGJ4QXBpICovXG5cbmNvbnN0IGN1c3RvbUZpbGUgPSB7XG5cdCRmb3JtT2JqOiAkKCcjY3VzdG9tLWZpbGUtZm9ybScpLFxuXHQkdHlwZVNlbGVjdERyb3BEb3duOiAkKCcjY3VzdG9tLWZpbGUtZm9ybSAudHlwZS1zZWxlY3QnKSxcblx0JGFwcENvZGU6ICQoJyNhcHBsaWNhdGlvbi1jb2RlJyksXG5cdCRhcHBDb2RlRnJvbVNlcnZlcjogJCgnI2FwcGxpY2F0aW9uLWNvZGUtcmVhZG9ubHknKSxcblx0ZWRpdG9yOiAnJyxcblx0dmlld2VyOiAnJyxcblx0dmFsaWRhdGVSdWxlczoge1xuXHRcdG5hbWU6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdmaWxlcGF0aCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jZl9WYWxpZGF0ZU5hbWVJc0VtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHR9LFxuXHRpbml0aWFsaXplKCkge1xuXHRcdGN1c3RvbUZpbGUuJHR5cGVTZWxlY3REcm9wRG93bi5kcm9wZG93bih7XG5cdFx0XHRvbkNoYW5nZSgpIHtcblx0XHRcdFx0Y3VzdG9tRmlsZS5oaWRlU2hvd0NvZGUoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS5nZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIoKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHRjdXN0b21GaWxlLmluaXRpYWxpemVBY2UoKTtcblx0XHRjdXN0b21GaWxlLmluaXRpYWxpemVGb3JtKCk7XG5cdFx0Y3VzdG9tRmlsZS5nZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIoKTtcblx0fSxcblx0aGlkZVNob3dDb2RlKCkge1xuXHRcdGNvbnN0IGFjZUhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodC01MDA7XG5cdFx0Y29uc3Qgcm93c0NvdW50ID0gTWF0aC5yb3VuZChhY2VIZWlnaHQvMTYuMyk7XG5cdFx0JCh3aW5kb3cpLmxvYWQoZnVuY3Rpb24oKSB7XG5cdFx0XHQkKCcuYXBwbGljYXRpb24tY29kZS1yZWFkb25seScpLmNzcygnbWluLWhlaWdodCcsIGAke2FjZUhlaWdodH1weGApO1xuXHRcdFx0JCgnLmFwcGxpY2F0aW9uLWNvZGUnKS5jc3MoJ21pbi1oZWlnaHQnLCBgJHthY2VIZWlnaHR9cHhgKTtcblx0XHR9KTtcblx0XHRjb25zdCBtb2RlID0gY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnbW9kZScpO1xuXHRcdHN3aXRjaCAobW9kZSkge1xuXHRcdFx0Y2FzZSAnbm9uZSc6XG5cdFx0XHRcdGN1c3RvbUZpbGUudmlld2VyLm5hdmlnYXRlRmlsZVN0YXJ0KCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGVGcm9tU2VydmVyLnNob3coKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZS5oaWRlKCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUudmlld2VyLnNldE9wdGlvbnMoe1xuXHRcdFx0XHRcdG1heExpbmVzOiByb3dzQ291bnQsXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRjdXN0b21GaWxlLnZpZXdlci5yZXNpemUoKVxuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ2FwcGVuZCc6XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGVGcm9tU2VydmVyLnNob3coKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS52aWV3ZXIubmF2aWdhdGVGaWxlRW5kKCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLnNldFZhbHVlKGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2NvbnRlbnQnKSk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGUuc2hvdygpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ292ZXJyaWRlJzpcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3IubmF2aWdhdGVGaWxlU3RhcnQoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZUZyb21TZXJ2ZXIuaGlkZSgpO1xuXHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXRWYWx1ZShjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdjb250ZW50JykpO1xuXHRcdFx0XHRjdXN0b21GaWxlLiRhcHBDb2RlLnNob3coKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3Iuc2V0T3B0aW9ucyh7XG5cdFx0XHRcdFx0bWF4TGluZXM6IHJvd3NDb3VudCxcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLnJlc2l6ZSgpXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9LFxuXHRjYkdldEZpbGVDb250ZW50RnJvbVNlcnZlcihyZXNwb25zZSkge1xuXHRcdGlmIChyZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb25zdCBmaWxlQ29udGVudCA9IGRlY29kZVVSSUNvbXBvbmVudChyZXNwb25zZS5kYXRhLmNvbnRlbnQpO1xuXHRcdFx0Y3VzdG9tRmlsZS52aWV3ZXIuc2V0VmFsdWUoZmlsZUNvbnRlbnQpO1xuXHRcdFx0Y3VzdG9tRmlsZS5oaWRlU2hvd0NvZGUoKTtcblx0XHR9XG5cdH0sXG5cdGdldEZpbGVDb250ZW50RnJvbVNlcnZlcigpIHtcblx0XHRjb25zdCBmaWxlUGF0aCA9IGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2ZpbGVwYXRoJyk7XG5cdFx0Y29uc3QgbW9kZSA9IGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ21vZGUnKSAhPT0gJ292ZXJyaWRlJztcblx0XHRjb25zdCBkYXRhID0geyBmaWxlbmFtZTogZmlsZVBhdGgsIG5lZWRPcmlnaW5hbDogbW9kZSwgbmVlZExvZ2ZpbGU6IGZhbHNlIH07XG5cdFx0UGJ4QXBpLkdldEZpbGVDb250ZW50KGRhdGEsIGN1c3RvbUZpbGUuY2JHZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIpO1xuXHR9LFxuXHRpbml0aWFsaXplQWNlKCkge1xuXHRcdGNvbnN0IEluaU1vZGUgPSBhY2UucmVxdWlyZSgnYWNlL21vZGUvanVsaWEnKS5Nb2RlO1xuXHRcdGN1c3RvbUZpbGUudmlld2VyID0gYWNlLmVkaXQoJ2FwcGxpY2F0aW9uLWNvZGUtcmVhZG9ubHknKTtcblx0XHRjdXN0b21GaWxlLnZpZXdlci5zZXNzaW9uLnNldE1vZGUobmV3IEluaU1vZGUoKSk7XG5cdFx0Y3VzdG9tRmlsZS52aWV3ZXIuc2V0VGhlbWUoJ2FjZS90aGVtZS9tb25va2FpJyk7XG5cdFx0Y3VzdG9tRmlsZS52aWV3ZXIuc2V0T3B0aW9ucyh7XG5cdFx0XHRzaG93UHJpbnRNYXJnaW46IGZhbHNlLFxuXHRcdFx0cmVhZE9ubHk6IHRydWVcblx0XHR9KTtcblx0XHRjdXN0b21GaWxlLnZpZXdlci5yZXNpemUoKTtcblxuXHRcdGN1c3RvbUZpbGUuZWRpdG9yID0gYWNlLmVkaXQoJ2FwcGxpY2F0aW9uLWNvZGUnKTtcblx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXRUaGVtZSgnYWNlL3RoZW1lL21vbm9rYWknKTtcblx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXNzaW9uLnNldE1vZGUobmV3IEluaU1vZGUoKSk7XG5cdFx0Y3VzdG9tRmlsZS5lZGl0b3Iuc2V0T3B0aW9ucyh7XG5cdFx0XHRzaG93UHJpbnRNYXJnaW46IGZhbHNlLFxuXHRcdH0pO1xuXHRcdGN1c3RvbUZpbGUuZWRpdG9yLnJlc2l6ZSgpO1xuXHR9LFxuXHRjYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKSB7XG5cdFx0Y29uc3QgcmVzdWx0ID0gc2V0dGluZ3M7XG5cdFx0cmVzdWx0LmRhdGEgPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0XHRzd2l0Y2ggKGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ21vZGUnKSkge1xuXHRcdFx0Y2FzZSAnYXBwZW5kJzpcblx0XHRcdGNhc2UgJ292ZXJyaWRlJzpcblx0XHRcdFx0cmVzdWx0LmRhdGEuY29udGVudCA9IGN1c3RvbUZpbGUuZWRpdG9yLmdldFZhbHVlKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0cmVzdWx0LmRhdGEuY29udGVudCA9ICcnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHRjYkFmdGVyU2VuZEZvcm0oKSB7XG5cblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IGN1c3RvbUZpbGUuJGZvcm1PYmo7XG5cdFx0Rm9ybS51cmwgPSBgJHtnbG9iYWxSb290VXJsfWN1c3RvbS1maWxlcy9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBjdXN0b21GaWxlLnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gY3VzdG9tRmlsZS5jYkJlZm9yZVNlbmRGb3JtO1xuXHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtID0gY3VzdG9tRmlsZS5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5lbmFibGVEaXJyaXR5ID0gZmFsc2U7XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG5cdGN1c3RvbUZpbGUuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==