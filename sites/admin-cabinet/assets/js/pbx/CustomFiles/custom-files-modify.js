"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 12 2019
 *
 */

/* global globalRootUrl,globalTranslate, ace, Form, PbxApi */
var customFile = {
  $formObj: $('#custom-file-form'),
  $typeSelectDropDown: $('#custom-file-form .type-select'),
  $appCode: $('#application-code'),
  $appCodeFromServer: $('#application-code-readonly'),
  $dirrtyField: $('#dirrty'),
  editor: '',
  viewer: '',
  validateRules: {
    name: {
      identifier: 'filepath',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cf_ValidateNameIsEmpty
      }]
    }
  },
  initialize: function () {
    function initialize() {
      customFile.$typeSelectDropDown.dropdown({
        onChange: function () {
          function onChange() {
            customFile.hideShowCode();
            customFile.getFileContentFromServer();
          }

          return onChange;
        }()
      });
      customFile.initializeAce();
      customFile.initializeForm();
      customFile.getFileContentFromServer();
    }

    return initialize;
  }(),
  hideShowCode: function () {
    function hideShowCode() {
      var aceHeight = window.innerHeight - 475;
      var rowsCount = Math.round(aceHeight / 16.3);
      $(window).load(function () {
        $('.application-code-readonly').css('min-height', "".concat(aceHeight, "px"));
        $('.application-code').css('min-height', "".concat(aceHeight, "px"));
      });
      var mode = customFile.$formObj.form('get value', 'mode');

      switch (mode) {
        case 'none':
          customFile.viewer.navigateFileStart();
          customFile.$appCodeFromServer.show();
          customFile.$appCode.hide();
          customFile.viewer.setOptions({
            maxLines: rowsCount
          });
          customFile.viewer.resize();
          break;

        case 'append':
          customFile.$appCodeFromServer.show();
          customFile.viewer.navigateFileEnd();
          customFile.editor.setValue(customFile.$formObj.form('get value', 'content'));
          customFile.$appCode.show();
          customFile.editor.getSession().on('change', function () {
            customFile.$dirrtyField.val(Math.random());
            customFile.$dirrtyField.trigger('change');
          });
          break;

        case 'override':
          customFile.editor.navigateFileStart();
          customFile.$appCodeFromServer.hide();
          var changedContent = customFile.$formObj.form('get value', 'content');

          if (changedContent.length > 0) {
            customFile.editor.getSession().setValue(changedContent);
          } else {
            customFile.editor.getSession().setValue(customFile.viewer.getValue());
          }

          customFile.$appCode.show();
          customFile.editor.setOptions({
            maxLines: rowsCount
          });
          customFile.editor.resize();
          customFile.editor.getSession().on('change', function () {
            customFile.$dirrtyField.val(Math.random());
            customFile.$dirrtyField.trigger('change');
          });
          break;

        default:
          break;
      }
    }

    return hideShowCode;
  }(),
  cbGetFileContentFromServer: function () {
    function cbGetFileContentFromServer(response) {
      if (response !== undefined) {
        customFile.viewer.getSession().setValue(response.data.content);
        customFile.hideShowCode();
      }
    }

    return cbGetFileContentFromServer;
  }(),
  getFileContentFromServer: function () {
    function getFileContentFromServer() {
      var filePath = customFile.$formObj.form('get value', 'filepath');
      var mode = customFile.$formObj.form('get value', 'mode') !== 'override';
      var data = {
        filename: filePath,
        needOriginal: mode,
        needLogfile: false
      };
      PbxApi.GetFileContent(data, customFile.cbGetFileContentFromServer);
    }

    return getFileContentFromServer;
  }(),
  initializeAce: function () {
    function initializeAce() {
      var IniMode = ace.require('ace/mode/julia').Mode;

      customFile.viewer = ace.edit('application-code-readonly');
      customFile.viewer.session.setMode(new IniMode());
      customFile.viewer.setTheme('ace/theme/monokai');
      customFile.viewer.setOptions({
        showPrintMargin: false,
        readOnly: true
      });
      customFile.viewer.resize();
      customFile.editor = ace.edit('application-code');
      customFile.editor.setTheme('ace/theme/monokai');
      customFile.editor.session.setMode(new IniMode());
      customFile.editor.setOptions({
        showPrintMargin: false
      });
      customFile.editor.resize();
    }

    return initializeAce;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = customFile.$formObj.form('get values');

      switch (customFile.$formObj.form('get value', 'mode')) {
        case 'append':
        case 'override':
          result.data.content = customFile.editor.getValue();
          break;

        default:
          result.data.content = '';
      }

      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {}

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = customFile.$formObj;
      Form.url = "".concat(globalRootUrl, "custom-files/save");
      Form.validateRules = customFile.validateRules;
      Form.cbBeforeSendForm = customFile.cbBeforeSendForm;
      Form.cbAfterSendForm = customFile.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  customFile.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DdXN0b21GaWxlcy9jdXN0b20tZmlsZXMtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbImN1c3RvbUZpbGUiLCIkZm9ybU9iaiIsIiQiLCIkdHlwZVNlbGVjdERyb3BEb3duIiwiJGFwcENvZGUiLCIkYXBwQ29kZUZyb21TZXJ2ZXIiLCIkZGlycnR5RmllbGQiLCJlZGl0b3IiLCJ2aWV3ZXIiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJjZl9WYWxpZGF0ZU5hbWVJc0VtcHR5IiwiaW5pdGlhbGl6ZSIsImRyb3Bkb3duIiwib25DaGFuZ2UiLCJoaWRlU2hvd0NvZGUiLCJnZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIiLCJpbml0aWFsaXplQWNlIiwiaW5pdGlhbGl6ZUZvcm0iLCJhY2VIZWlnaHQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsInJvd3NDb3VudCIsIk1hdGgiLCJyb3VuZCIsImxvYWQiLCJjc3MiLCJtb2RlIiwiZm9ybSIsIm5hdmlnYXRlRmlsZVN0YXJ0Iiwic2hvdyIsImhpZGUiLCJzZXRPcHRpb25zIiwibWF4TGluZXMiLCJyZXNpemUiLCJuYXZpZ2F0ZUZpbGVFbmQiLCJzZXRWYWx1ZSIsImdldFNlc3Npb24iLCJvbiIsInZhbCIsInJhbmRvbSIsInRyaWdnZXIiLCJjaGFuZ2VkQ29udGVudCIsImxlbmd0aCIsImdldFZhbHVlIiwiY2JHZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIiLCJyZXNwb25zZSIsInVuZGVmaW5lZCIsImRhdGEiLCJjb250ZW50IiwiZmlsZVBhdGgiLCJmaWxlbmFtZSIsIm5lZWRPcmlnaW5hbCIsIm5lZWRMb2dmaWxlIiwiUGJ4QXBpIiwiR2V0RmlsZUNvbnRlbnQiLCJJbmlNb2RlIiwiYWNlIiwicmVxdWlyZSIsIk1vZGUiLCJlZGl0Iiwic2Vzc2lvbiIsInNldE1vZGUiLCJzZXRUaGVtZSIsInNob3dQcmludE1hcmdpbiIsInJlYWRPbmx5IiwiY2JCZWZvcmVTZW5kRm9ybSIsInNldHRpbmdzIiwicmVzdWx0IiwiY2JBZnRlclNlbmRGb3JtIiwiRm9ybSIsInVybCIsImdsb2JhbFJvb3RVcmwiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7OztBQVFBO0FBRUEsSUFBTUEsVUFBVSxHQUFHO0FBQ2xCQyxFQUFBQSxRQUFRLEVBQUVDLENBQUMsQ0FBQyxtQkFBRCxDQURPO0FBRWxCQyxFQUFBQSxtQkFBbUIsRUFBRUQsQ0FBQyxDQUFDLGdDQUFELENBRko7QUFHbEJFLEVBQUFBLFFBQVEsRUFBRUYsQ0FBQyxDQUFDLG1CQUFELENBSE87QUFJbEJHLEVBQUFBLGtCQUFrQixFQUFFSCxDQUFDLENBQUMsNEJBQUQsQ0FKSDtBQUtsQkksRUFBQUEsWUFBWSxFQUFFSixDQUFDLENBQUMsU0FBRCxDQUxHO0FBTWxCSyxFQUFBQSxNQUFNLEVBQUUsRUFOVTtBQU9sQkMsRUFBQUEsTUFBTSxFQUFFLEVBUFU7QUFRbEJDLEVBQUFBLGFBQWEsRUFBRTtBQUNkQyxJQUFBQSxJQUFJLEVBQUU7QUFDTEMsTUFBQUEsVUFBVSxFQUFFLFVBRFA7QUFFTEMsTUFBQUEsS0FBSyxFQUFFLENBQ047QUFDQ0MsUUFBQUEsSUFBSSxFQUFFLE9BRFA7QUFFQ0MsUUFBQUEsTUFBTSxFQUFFQyxlQUFlLENBQUNDO0FBRnpCLE9BRE07QUFGRjtBQURRLEdBUkc7QUFtQmxCQyxFQUFBQSxVQW5Ca0I7QUFBQSwwQkFtQkw7QUFDWmpCLE1BQUFBLFVBQVUsQ0FBQ0csbUJBQVgsQ0FBK0JlLFFBQS9CLENBQXdDO0FBQ3ZDQyxRQUFBQSxRQUR1QztBQUFBLDhCQUM1QjtBQUNWbkIsWUFBQUEsVUFBVSxDQUFDb0IsWUFBWDtBQUNBcEIsWUFBQUEsVUFBVSxDQUFDcUIsd0JBQVg7QUFDQTs7QUFKc0M7QUFBQTtBQUFBLE9BQXhDO0FBT0FyQixNQUFBQSxVQUFVLENBQUNzQixhQUFYO0FBQ0F0QixNQUFBQSxVQUFVLENB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LFVBQVUsQ0FBQ2lCLFVBQVg7QUFDQSxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoQykgTUlLTyBMTEMgLSBBbGwgUmlnaHRzIFJlc2VydmVkXG4gKiBVbmF1dGhvcml6ZWQgY29weWluZyBvZiB0aGlzIGZpbGUsIHZpYSBhbnkgbWVkaXVtIGlzIHN0cmljdGx5IHByb2hpYml0ZWRcbiAqIFByb3ByaWV0YXJ5IGFuZCBjb25maWRlbnRpYWxcbiAqIFdyaXR0ZW4gYnkgTmlrb2xheSBCZWtldG92LCAxMiAyMDE5XG4gKlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLGdsb2JhbFRyYW5zbGF0ZSwgYWNlLCBGb3JtLCBQYnhBcGkgKi9cblxuY29uc3QgY3VzdG9tRmlsZSA9IHtcblx0JGZvcm1PYmo6ICQoJyNjdXN0b20tZmlsZS1mb3JtJyksXG5cdCR0eXBlU2VsZWN0RHJvcERvd246ICQoJyNjdXN0b20tZmlsZS1mb3JtIC50eXBlLXNlbGVjdCcpLFxuXHQkYXBwQ29kZTogJCgnI2FwcGxpY2F0aW9uLWNvZGUnKSxcblx0JGFwcENvZGVGcm9tU2VydmVyOiAkKCcjYXBwbGljYXRpb24tY29kZS1yZWFkb25seScpLFxuXHQkZGlycnR5RmllbGQ6ICQoJyNkaXJydHknKSxcblx0ZWRpdG9yOiAnJyxcblx0dmlld2VyOiAnJyxcblx0dmFsaWRhdGVSdWxlczoge1xuXHRcdG5hbWU6IHtcblx0XHRcdGlkZW50aWZpZXI6ICdmaWxlcGF0aCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jZl9WYWxpZGF0ZU5hbWVJc0VtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHR9LFxuXHRpbml0aWFsaXplKCkge1xuXHRcdGN1c3RvbUZpbGUuJHR5cGVTZWxlY3REcm9wRG93bi5kcm9wZG93bih7XG5cdFx0XHRvbkNoYW5nZSgpIHtcblx0XHRcdFx0Y3VzdG9tRmlsZS5oaWRlU2hvd0NvZGUoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS5nZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIoKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHRjdXN0b21GaWxlLmluaXRpYWxpemVBY2UoKTtcblx0XHRjdXN0b21GaWxlLmluaXRpYWxpemVGb3JtKCk7XG5cdFx0Y3VzdG9tRmlsZS5nZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIoKTtcblx0fSxcblx0aGlkZVNob3dDb2RlKCkge1xuXHRcdGNvbnN0IGFjZUhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodC00NzU7XG5cdFx0Y29uc3Qgcm93c0NvdW50ID0gTWF0aC5yb3VuZChhY2VIZWlnaHQvMTYuMyk7XG5cdFx0JCh3aW5kb3cpLmxvYWQoZnVuY3Rpb24oKSB7XG5cdFx0XHQkKCcuYXBwbGljYXRpb24tY29kZS1yZWFkb25seScpLmNzcygnbWluLWhlaWdodCcsIGAke2FjZUhlaWdodH1weGApO1xuXHRcdFx0JCgnLmFwcGxpY2F0aW9uLWNvZGUnKS5jc3MoJ21pbi1oZWlnaHQnLCBgJHthY2VIZWlnaHR9cHhgKTtcblx0XHR9KTtcblx0XHRjb25zdCBtb2RlID0gY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnbW9kZScpO1xuXHRcdHN3aXRjaCAobW9kZSkge1xuXHRcdFx0Y2FzZSAnbm9uZSc6XG5cdFx0XHRcdGN1c3RvbUZpbGUudmlld2VyLm5hdmlnYXRlRmlsZVN0YXJ0KCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGVGcm9tU2VydmVyLnNob3coKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZS5oaWRlKCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUudmlld2VyLnNldE9wdGlvbnMoe1xuXHRcdFx0XHRcdG1heExpbmVzOiByb3dzQ291bnQsXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRjdXN0b21GaWxlLnZpZXdlci5yZXNpemUoKVxuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ2FwcGVuZCc6XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGVGcm9tU2VydmVyLnNob3coKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS52aWV3ZXIubmF2aWdhdGVGaWxlRW5kKCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLnNldFZhbHVlKGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2NvbnRlbnQnKSk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGUuc2hvdygpO1xuXHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5nZXRTZXNzaW9uKCkub24oJ2NoYW5nZScsICgpID0+IHtcblx0XHRcdFx0XHRjdXN0b21GaWxlLiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRcdFx0Y3VzdG9tRmlsZS4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ292ZXJyaWRlJzpcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3IubmF2aWdhdGVGaWxlU3RhcnQoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZUZyb21TZXJ2ZXIuaGlkZSgpO1xuXHRcdFx0XHRjb25zdCBjaGFuZ2VkQ29udGVudCA9IGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2NvbnRlbnQnKTtcblx0XHRcdFx0aWYgKGNoYW5nZWRDb250ZW50Lmxlbmd0aD4wKXtcblx0XHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5nZXRTZXNzaW9uKCkuc2V0VmFsdWUoY2hhbmdlZENvbnRlbnQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLmdldFNlc3Npb24oKS5zZXRWYWx1ZShjdXN0b21GaWxlLnZpZXdlci5nZXRWYWx1ZSgpKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRjdXN0b21GaWxlLiRhcHBDb2RlLnNob3coKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3Iuc2V0T3B0aW9ucyh7XG5cdFx0XHRcdFx0bWF4TGluZXM6IHJvd3NDb3VudCxcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLnJlc2l6ZSgpXG5cdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLmdldFNlc3Npb24oKS5vbignY2hhbmdlJywgKCkgPT4ge1xuXHRcdFx0XHRcdGN1c3RvbUZpbGUuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0XHRjdXN0b21GaWxlLiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9LFxuXHRjYkdldEZpbGVDb250ZW50RnJvbVNlcnZlcihyZXNwb25zZSkge1xuXHRcdGlmIChyZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjdXN0b21GaWxlLnZpZXdlci5nZXRTZXNzaW9uKCkuc2V0VmFsdWUocmVzcG9uc2UuZGF0YS5jb250ZW50KTtcblx0XHRcdGN1c3RvbUZpbGUuaGlkZVNob3dDb2RlKCk7XG5cdFx0fVxuXHR9LFxuXHRnZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIoKSB7XG5cdFx0Y29uc3QgZmlsZVBhdGggPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdmaWxlcGF0aCcpO1xuXHRcdGNvbnN0IG1vZGUgPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdtb2RlJykgIT09ICdvdmVycmlkZSc7XG5cdFx0Y29uc3QgZGF0YSA9IHsgZmlsZW5hbWU6IGZpbGVQYXRoLCBuZWVkT3JpZ2luYWw6IG1vZGUsIG5lZWRMb2dmaWxlOiBmYWxzZSB9O1xuXHRcdFBieEFwaS5HZXRGaWxlQ29udGVudChkYXRhLCBjdXN0b21GaWxlLmNiR2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKTtcblx0fSxcblx0aW5pdGlhbGl6ZUFjZSgpIHtcblx0XHRjb25zdCBJbmlNb2RlID0gYWNlLnJlcXVpcmUoJ2FjZS9tb2RlL2p1bGlhJykuTW9kZTtcblx0XHRjdXN0b21GaWxlLnZpZXdlciA9IGFjZS5lZGl0KCdhcHBsaWNhdGlvbi1jb2RlLXJlYWRvbmx5Jyk7XG5cdFx0Y3VzdG9tRmlsZS52aWV3ZXIuc2Vzc2lvbi5zZXRNb2RlKG5ldyBJbmlNb2RlKCkpO1xuXHRcdGN1c3RvbUZpbGUudmlld2VyLnNldFRoZW1lKCdhY2UvdGhlbWUvbW9ub2thaScpO1xuXHRcdGN1c3RvbUZpbGUudmlld2VyLnNldE9wdGlvbnMoe1xuXHRcdFx0c2hvd1ByaW50TWFyZ2luOiBmYWxzZSxcblx0XHRcdHJlYWRPbmx5OiB0cnVlXG5cdFx0fSk7XG5cdFx0Y3VzdG9tRmlsZS52aWV3ZXIucmVzaXplKCk7XG5cblx0XHRjdXN0b21GaWxlLmVkaXRvciA9IGFjZS5lZGl0KCdhcHBsaWNhdGlvbi1jb2RlJyk7XG5cdFx0Y3VzdG9tRmlsZS5lZGl0b3Iuc2V0VGhlbWUoJ2FjZS90aGVtZS9tb25va2FpJyk7XG5cdFx0Y3VzdG9tRmlsZS5lZGl0b3Iuc2Vzc2lvbi5zZXRNb2RlKG5ldyBJbmlNb2RlKCkpO1xuXHRcdGN1c3RvbUZpbGUuZWRpdG9yLnNldE9wdGlvbnMoe1xuXHRcdFx0c2hvd1ByaW50TWFyZ2luOiBmYWxzZSxcblx0XHR9KTtcblx0XHRjdXN0b21GaWxlLmVkaXRvci5yZXNpemUoKTtcblx0fSxcblx0Y2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuXHRcdGNvbnN0IHJlc3VsdCA9IHNldHRpbmdzO1xuXHRcdHJlc3VsdC5kYXRhID0gY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdFx0c3dpdGNoIChjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdtb2RlJykpIHtcblx0XHRcdGNhc2UgJ2FwcGVuZCc6XG5cdFx0XHRjYXNlICdvdmVycmlkZSc6XG5cdFx0XHRcdHJlc3VsdC5kYXRhLmNvbnRlbnQgPSBjdXN0b21GaWxlLmVkaXRvci5nZXRWYWx1ZSgpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHJlc3VsdC5kYXRhLmNvbnRlbnQgPSAnJztcblx0XHR9XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fSxcblx0Y2JBZnRlclNlbmRGb3JtKCkge1xuXG5cdH0sXG5cdGluaXRpYWxpemVGb3JtKCkge1xuXHRcdEZvcm0uJGZvcm1PYmogPSBjdXN0b21GaWxlLiRmb3JtT2JqO1xuXHRcdEZvcm0udXJsID0gYCR7Z2xvYmFsUm9vdFVybH1jdXN0b20tZmlsZXMvc2F2ZWA7XG5cdFx0Rm9ybS52YWxpZGF0ZVJ1bGVzID0gY3VzdG9tRmlsZS52YWxpZGF0ZVJ1bGVzO1xuXHRcdEZvcm0uY2JCZWZvcmVTZW5kRm9ybSA9IGN1c3RvbUZpbGUuY2JCZWZvcmVTZW5kRm9ybTtcblx0XHRGb3JtLmNiQWZ0ZXJTZW5kRm9ybSA9IGN1c3RvbUZpbGUuY2JBZnRlclNlbmRGb3JtO1xuXHRcdEZvcm0uaW5pdGlhbGl6ZSgpO1xuXHR9LFxufTtcblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRjdXN0b21GaWxlLmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=