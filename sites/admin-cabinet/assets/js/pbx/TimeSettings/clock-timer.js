"use strict";

/*
 * Copyright (C) MIKO LLC - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Nikolay Beketov, 10 2020
 *
 */
var clockTimer = {
  timerVar: null,
  startTime: null,
  $localTime: $("#ManualDateTime"),
  $serverTime: $("#SystemDateTime"),
  initialize: function () {
    function initialize() {
      clockTimer.startTime = parseInt(timeSettings.$formObj.form('get value', 'SystemDateTime'), 10) * 1000;
      clockTimer.timeoutHandle = window.setTimeout(clockTimer.countTimer, 1000);
      clockTimer.countTimer();
      timeSettings.$formObj.form({
        onChange: clockTimer.cbOnChangeTimeSettingsMode
      });
    }

    return initialize;
  }(),
  countTimer: function () {
    function countTimer() {
      if (timeSettings.$formObj.form('get value', 'PBXManualTimeSettings') !== 'on') {
        var now = Date.now();
        var diff = now - clockTimer.startTime;
        var serverTime = clockTimer.startTime + diff;
        timeSettings.$formObj.form('set value', 'ManualDateTime', new Date(serverTime).toLocaleString());
      } else {
        timeSettings.$formObj.form('set value', 'ManualDateTime', new Date(clockTimer.startTime).toLocaleString());
      }
    }

    return countTimer;
  }(),
  cbOnChangeTimeSettingsMode: function () {
    function cbOnChangeTimeSettingsMode(value) {
      if (value === 'on') {
        var localTime = new Date();
        timeSettings.$formObj.form('set value', 'ManualDateTime', localTime.toLocaleString());
        window.clearTimeout(clockTimer.timeoutHandle);
      } else {
        clockTimer.timeoutHandle = window.setTimeout(clockTimer.countTimer, 1000);
        clockTimer.countTimer();
      }
    }

    return cbOnChangeTimeSettingsMode;
  }()
};
$(document).ready(function () {
  clockTimer.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9UaW1lU2V0dGluZ3MvY2xvY2stdGltZXIuanMiXSwibmFtZXMiOlsiY2xvY2tUaW1lciIsInRpbWVyVmFyIiwic3RhcnRUaW1lIiwiJGxvY2FsVGltZSIsIiQiLCIkc2VydmVyVGltZSIsImluaXRpYWxpemUiLCJwYXJzZUludCIsInRpbWVTZXR0aW5ncyIsIiRmb3JtT2JqIiwiZm9ybSIsInRpbWVvdXRIYW5kbGUiLCJ3aW5kb3ciLCJzZXRUaW1lb3V0IiwiY291bnRUaW1lciIsIm9uQ2hhbmdlIiwiY2JPbkNoYW5nZVRpbWVTZXR0aW5nc01vZGUiLCJub3ciLCJEYXRlIiwiZGlmZiIsInNlcnZlclRpbWUiLCJ0b0xvY2FsZVN0cmluZyIsInZhbHVlIiwibG9jYWxUaW1lIiwiY2xlYXJUaW1lb3V0IiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQVFBLElBQU1BLFVBQVUsR0FBRztBQUNsQkMsRUFBQUEsUUFBUSxFQUFFLElBRFE7QUFFbEJDLEVBQUFBLFNBQVMsRUFBRSxJQUZPO0FBR2xCQyxFQUFBQSxVQUFVLEVBQUVDLENBQUMsQ0FBQyxpQkFBRCxDQUhLO0FBSWxCQyxFQUFBQSxXQUFXLEVBQUNELENBQUMsQ0FBQyxpQkFBRCxDQUpLO0FBS2xCRSxFQUFBQSxVQUxrQjtBQUFBLDBCQUtMO0FBQ1pOLE1BQUFBLFVBQVUsQ0FBQ0UsU0FBWCxHQUF1QkssUUFBUSxDQUFDQyxZQUFZLENBQUNDLFFBQWIsQ0FBc0JDLElBQXRCLENBQTJCLFdBQTNCLEVBQXdDLGdCQUF4QyxDQUFELEVBQTJELEVBQTNELENBQVIsR0FBdUUsSUFBOUY7QUFDQVYsTUFBQUEsVUFBVSxDQUFDVyxhQUFYLEdBQTJCQyxNQUFNLENBQUNDLFVBQVAsQ0FBa0JiLFVBQVUsQ0FBQ2MsVUFBN0IsRUFBeUMsSUFBekMsQ0FBM0I7QUFDQWQsTUFBQUEsVUFBVSxDQUFDYyxVQUFYO0FBQ0FOLE1BQUFBLFlBQVksQ0FBQ0MsUUFBYixDQUFzQkMsSUFBdEIsQ0FBMkI7QUFBQ0ssUUFBQUEsUUFBUSxFQUFDZixVQUFVLENBQUNnQjtBQUFyQixPQUEzQjtBQUNBOztBQVZpQjtBQUFBO0FBV2xCRixFQUFBQSxVQVhrQjtBQUFBLDBCQVdMO0FBQ1osVUFBSU4sWUFBWSxDQUFDQyxRQUFiLENBQXNCQyxJQUF0QixDQUEyQixXQUEzQixFQUF3Qyx1QkFBeEMsTUFBcUUsSUFBekUsRUFBK0U7QUFDOUUsWUFBTU8sR0FBRyxHQUFHQyxJQUFJLENBQUNELEdBQUwsRUFBWjtBQUNBLFlBQU1FLElBQUksR0FBR0YsR0FBRyxHQUFHakIsVUFBVSxDQUFDRSxTQUE5QjtBQUNBLFlBQU1rQixVQUFVLEdBQUdwQixVQUFVLENBQUNFLFNBQVgsR0FBdUJpQixJQUExQztBQUNBWCxRQUFBQSxZQUFZLENBQUNDLFFBQWIsQ0FBc0JDLElBQXRCLENBQTJCLFdBQTNCLEVBQXdDLGdCQUF4QyxFQUEwRCxJQUFJUSxJQUFKLENBQVNFLFVBQVQsRUFBcUJDLGNBQXJCLEVBQTFEO0FBQ0EsT0FMRCxNQUtPO0FBQ05iLFFBQUFBLFlBQVksQ0FBQ0MsUUFBYixDQUFzQkMsSUFBdEIsQ0FBMkIsV0FBM0IsRUFBd0MsZ0JBQXhDLEVBQTBELElBQUlRLElBQUosQ0FBU2xCLFVBQVUsQ0FBQ0UsU0FBcEIsRUFBK0JtQixjQUEvQixFQUExRDtBQUNBO0FBQ0Q7O0FBcEJpQjtBQUFBO0FBcUJsQkwsRUFBQUEsMEJBckJrQjtBQUFBLHdDQXFCU00sS0FyQlQsRUFxQmU7QUFDaEMsVUFBSUEsS0FBSyxLQUFHLElBQVosRUFBaUI7QUFDaEIsWUFBTUMsU0FBUyxHQUFHLElBQUlMLElBQUosRUFBbEI7QUFDQVYsUUFBQUEsWUFBWSxDQUFDQyxRQUFiLENBQXNCQyxJQUF0QixDQUEyQixXQUEzQixFQUF3QyxnQkFBeEMsRUFBMERhLFNBQVMsQ0FBQ0YsY0FBVixFQUExRDtBQUNBVCxRQUFBQSxNQUFNLENBQUNZLFlBQVAsQ0FBb0J4QixVQUFVLENBQUNXLGFBQS9CO0FBQ0EsT0FKRCxNQUlPO0FBQ05YLFFBQUFBLFVBQVUsQ0FBQ1csYUFBWCxHQUEyQkMsTUFBTSxDQUFDQyxVQUFQLENBQWtCYixVQUFVLENBQUNjLFVBQTdCLEVBQXlDLElBQXpDLENBQTNCO0FBQ0FkLFFBQUFBLFVBQVUsQ0FBQ2MsVUFBWDtBQUNBO0FBQ0Q7O0FBOUJpQjtBQUFBO0FBQUEsQ0FBbkI7QUFrQ0FWLENBQUMsQ0FBQ3FCLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDdkIxQixFQUFBQSxVQUFVLENBQUNNLFVBQVg7QUFDQSxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoQykgTUlLTyBMTEMgLSBBbGwgUmlnaHRzIFJlc2VydmVkXG4gKiBVbmF1dGhvcml6ZWQgY29weWluZyBvZiB0aGlzIGZpbGUsIHZpYSBhbnkgbWVkaXVtIGlzIHN0cmljdGx5IHByb2hpYml0ZWRcbiAqIFByb3ByaWV0YXJ5IGFuZCBjb25maWRlbnRpYWxcbiAqIFdyaXR0ZW4gYnkgTmlrb2xheSBCZWtldG92LCAxMCAyMDIwXG4gKlxuICovXG5cbmNvbnN0IGNsb2NrVGltZXIgPSB7XG5cdHRpbWVyVmFyOiBudWxsLFxuXHRzdGFydFRpbWU6IG51bGwsXG5cdCRsb2NhbFRpbWU6ICQoXCIjTWFudWFsRGF0ZVRpbWVcIiksXG5cdCRzZXJ2ZXJUaW1lOiQoXCIjU3lzdGVtRGF0ZVRpbWVcIiksXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0Y2xvY2tUaW1lci5zdGFydFRpbWUgPSBwYXJzZUludCh0aW1lU2V0dGluZ3MuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ1N5c3RlbURhdGVUaW1lJyksMTApKjEwMDA7XG5cdFx0Y2xvY2tUaW1lci50aW1lb3V0SGFuZGxlID0gd2luZG93LnNldFRpbWVvdXQoY2xvY2tUaW1lci5jb3VudFRpbWVyLCAxMDAwKTtcblx0XHRjbG9ja1RpbWVyLmNvdW50VGltZXIoKTtcblx0XHR0aW1lU2V0dGluZ3MuJGZvcm1PYmouZm9ybSh7b25DaGFuZ2U6Y2xvY2tUaW1lci5jYk9uQ2hhbmdlVGltZVNldHRpbmdzTW9kZX0pO1xuXHR9LFxuXHRjb3VudFRpbWVyKCkge1xuXHRcdGlmICh0aW1lU2V0dGluZ3MuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ1BCWE1hbnVhbFRpbWVTZXR0aW5ncycpICE9PSAnb24nKSB7XG5cdFx0XHRjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXHRcdFx0Y29uc3QgZGlmZiA9IG5vdyAtIGNsb2NrVGltZXIuc3RhcnRUaW1lO1xuXHRcdFx0Y29uc3Qgc2VydmVyVGltZSA9IGNsb2NrVGltZXIuc3RhcnRUaW1lICsgZGlmZjtcblx0XHRcdHRpbWVTZXR0aW5ncy4kZm9ybU9iai5mb3JtKCdzZXQgdmFsdWUnLCAnTWFudWFsRGF0ZVRpbWUnLCBuZXcgRGF0ZShzZXJ2ZXJUaW1lKS50b0xvY2FsZVN0cmluZygpKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGltZVNldHRpbmdzLiRmb3JtT2JqLmZvcm0oJ3NldCB2YWx1ZScsICdNYW51YWxEYXRlVGltZScsIG5ldyBEYXRlKGNsb2NrVGltZXIuc3RhcnRUaW1lKS50b0xvY2FsZVN0cmluZygpKTtcblx0XHR9XG5cdH0sXG5cdGNiT25DaGFuZ2VUaW1lU2V0dGluZ3NNb2RlKHZhbHVlKXtcblx0XHRpZiAodmFsdWU9PT0nb24nKXtcblx0XHRcdGNvbnN0IGxvY2FsVGltZSA9IG5ldyBEYXRlKCk7XG5cdFx0XHR0aW1lU2V0dGluZ3MuJGZvcm1PYmouZm9ybSgnc2V0IHZhbHVlJywgJ01hbnVhbERhdGVUaW1lJywgbG9jYWxUaW1lLnRvTG9jYWxlU3RyaW5nKCkpO1xuXHRcdFx0d2luZG93LmNsZWFyVGltZW91dChjbG9ja1RpbWVyLnRpbWVvdXRIYW5kbGUpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjbG9ja1RpbWVyLnRpbWVvdXRIYW5kbGUgPSB3aW5kb3cuc2V0VGltZW91dChjbG9ja1RpbWVyLmNvdW50VGltZXIsIDEwMDApO1xuXHRcdFx0Y2xvY2tUaW1lci5jb3VudFRpbWVyKCk7XG5cdFx0fVxuXHR9XG5cbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0Y2xvY2tUaW1lci5pbml0aWFsaXplKCk7XG59KTtcbiJdfQ==